(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{103:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return i})),n.d(t,"default",(function(){return d}));var a=n(3),o=n(7),r=(n(0),n(181)),c={id:"iot7",title:"Contract Interactions",sidebar_label:"Contract Interactions",slug:"/dapp-iot/interactions"},s={unversionedId:"dapp-iot/iot7",id:"dapp-iot/iot7",isDocsHomePage:!1,title:"Contract Interactions",description:"Connect to Thanos' utilities",source:"@site/docs/dapp-iot/iot7.md",slug:"/dapp-iot/interactions",permalink:"/completium-landing/docs/dapp-iot/interactions",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/dapp-iot/iot7.md",version:"current",sidebar_label:"Contract Interactions",sidebar:"iot",previous:{title:"Contract Origination",permalink:"/completium-landing/docs/dapp-iot/origination"},next:{title:"Interface",permalink:"/completium-landing/docs/dapp-iot/interface"}},i=[{value:"Connect to Thanos&#39; utilities",id:"connect-to-thanos-utilities",children:[]},{value:"Read Connected Object parameters",id:"read-connected-object-parameters",children:[]},{value:"Read account",id:"read-account",children:[]},{value:"Start service",id:"start-service",children:[]},{value:"Interrupt service",id:"interrupt-service",children:[]}],p={toc:i};function d(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"connect-to-thanos-utilities"},"Connect to Thanos' utilities"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"function App() {\n  return (\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Wrap the App's body with <DAppProvider> tag/function in order to benefit\n    // from wallet's service as defined in dapp.js\n    ///////////////////////////////////////////////////////////////////////////\n    <React.Suspense fallback={null}>\n      <PageRouter />\n    </React.Suspense>\n  );\n}\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"function App() {\n    return (\n        <DAppProvider appName={appName}>\n      <React.Suspense fallback={null}>\n        <PageRouter />\n      </React.Suspense>\n    </DAppProvider>\n  );\n}\n")),Object(r.b)("h2",{id:"read-connected-object-parameters"},"Read Connected Object parameters"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"async function loadSwitchContent () {\n    try {\n      ///////////////////////////////////////////////////////////////////////////\n      // FIX ME:\n      // Read contract storage:\n      // * rate\n      // * date of start\n      // * date of stop\n      // * user\n      ///////////////////////////////////////////////////////////////////////////\n    } catch (error) {\n      console.log(`Error: ${error}`);\n    }\n  }\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"    const Tezos = new TezosToolkit('https://delphinet-tezos.giganode.io');\n    var contract  = await Tezos.contract.at(contractAddress);\n    var cstorage   = await contract.storage();\n    var dateofstart = new Date(cstorage.dateofstart);\n    var dateofstop = new Date(cstorage.dateofstop);\n    var rate = parseInt(0+cstorage.rate[4])/parseInt(0+cstorage.rate[3]);\n    var user = cstorage.user;\n    setBCSwitch({\n      dateofstart: dateofstart,\n      dateofstop : dateofstop,\n      rate: rate,\n      user: user,\n    });\n")),Object(r.b)("h2",{id:"read-account"},"Read account"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const loadBalance = React.useCallback(async () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // RETRIEVE ACCOUNT BALANCE\n    // Method props.setBalance(string) is passed the account's balance\n    ///////////////////////////////////////////////////////////////////////////\n}, [tezos, account, props.setBalance]);\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const loadBalance = React.useCallback(async () => {\n    const bal = await tezos.tz.getBalance(address);\n    props.setBalance(tezos.format('mutez', 'tz', bal).toString());\n}, [tezos, address, props.setBalance]);\n")),Object(r.b)("h2",{id:"start-service"},"Start service"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const handleStart = (event) => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME:\n    // Invode contract's 'start' entry point and provide the\n    // amount of tezos corresponding to the requested duration\n    ///////////////////////////////////////////////////////////////////////////\n}\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.at(contractAddress).then(contract => {\n    var price = (props.switch.rate * duration).toFixed(6);\n    console.log(`calling start with ${price} XTZ`);\n    contract.methods.start(UnitValue).send({ amount : price, fee : '0.1' }).then( op => {\n      var start = Date.now();\n      console.log(`waiting for ${op.opHash} to be confirmed`);\n      setDisable(true);\n      props.openSnack();\n      op.receipt().then(() => {\n        setDisable(false);\n        props.closeSnack();\n        props.resetBalance();\n        props.loadSwitchContent();\n      });\n    })\n});\n")),Object(r.b)("h2",{id:"interrupt-service"},"Interrupt service"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const handleInterrupt = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME:\n    // Invode contract's 'interrupt' entry point\n    ///////////////////////////////////////////////////////////////////////////\n}\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.at(contractAddress).then(contract => {\n    contract.methods.interrupt(UnitValue).send().then( op => {\n      var d = Date.now();\n      console.log(`waiting for ${op.opHash} to be confirmed`);\n      setDisable(true);\n      props.openSnack();\n      op.receipt().then(() => {\n        setDisable(false);\n        props.closeSnack();\n        props.resetBalance();\n        props.setBCSwitch({\n          dateofstart: d,\n          dateofstop: d,\n          rate: props.switch.rate,\n          user: props.switch.user\n        });\n      });\n    })\n});\n")))}d.isMDXComponent=!0}}]);