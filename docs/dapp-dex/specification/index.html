<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Completium Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Completium Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-react-helmet="true">Specification | Completium</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Specification | Completium"><meta data-react-helmet="true" name="description" content="Invariant"><meta data-react-helmet="true" property="og:description" content="Invariant"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/dapp-dex/specification"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/dapp-dex/specification"><link rel="stylesheet" href="/styles.12545298.css">
<link rel="preload" href="/styles.822531e8.js" as="script">
<link rel="preload" href="/runtime~main.c55d65e3.js" as="script">
<link rel="preload" href="/main.aa5006cf.js" as="script">
<link rel="preload" href="/common.98521b8c.js" as="script">
<link rel="preload" href="/2.10289d19.js" as="script">
<link rel="preload" href="/168.71275521.js" as="script">
<link rel="preload" href="/169.1de35d87.js" as="script">
<link rel="preload" href="/935f2afb.e6d3db93.js" as="script">
<link rel="preload" href="/163.3f948697.js" as="script">
<link rel="preload" href="/1bc7cd5f.5f783aea.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/dapp-first">First DApp</a><a class="navbar__item navbar__link" href="/dapps">DApps</a><a class="navbar__item navbar__link" href="/docs/contract">Smart Contract</a><a class="navbar__item navbar__link" href="/docs/templates">Contract Templates</a><a class="navbar__item navbar__link" href="/docs/verification">Formal Verification</a><a class="navbar__item navbar__link" href="/docs/cli">CLI</a><a class="navbar__item navbar__link" href="/docs/dapp-tools">Technical stack</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/edukera/completium-landing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dapp-first">First DApp</a></li><li class="menu__list-item"><a class="menu__link" href="/dapps">DApps</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/contract">Smart Contract</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/templates">Contract Templates</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/verification">Formal Verification</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dapp-tools">Technical stack</a></li><li class="menu__list-item"><a href="https://github.com/edukera/completium-landing" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Specification</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="invariant"></a>Invariant<a class="hash-link" href="#invariant" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">ledger.sum(tokens) = totalsupply</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No token is minted: the total number of tokens is equal to the initial totalsupply number of tokens, regardless of the state of the storage.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="transfer"></a>Transfer<a class="hash-link" href="#transfer" title="Direct link to heading">#</a></h2><p>When the <code>%to</code> address is different from the <code>%from</code> address, the number of tokens <code>%to</code> possesses is decread by value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-ledger"></a>Effect on <code>ledger</code><a class="hash-link" href="#effect-on-ledger" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-from-token-holder"></a>Effect on <code>%from</code> token holder<a class="hash-link" href="#effect-on-from-token-holder" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">%from &lt;&gt; %to -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some before_ledger_from = before.ledger[%from] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some after_ledger_from  = ledger[%from] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  after_ledger_from = { before_ledger_from with</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    tokens = abs (before_ledger_from.tokens - value)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise false</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-to-token-holder"></a>Effect on <code>%to</code> token holder<a class="hash-link" href="#effect-on-to-token-holder" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">%from &lt;&gt; %to -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some after_ledger_to = ledger[%to] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some before_ledger_to = before.ledger[%to] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  after_ledger_to = { before_ledger_to with</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    tokens = (before_ledger_to.tokens + value)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  after_ledger_to = { holder = %to; tokens = value }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When the <code>%to</code> address is different from the <code>%from</code> address, the number of tokens <code>%to</code> possesses is increased by value when <code>%to</code> is already registered in the ledger, and set to value otherwise. Anyway, <code>%to</code> is registered in ledger.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="no-effect-on-ledger"></a>No effect on <code>ledger</code><a class="hash-link" href="#no-effect-on-ledger" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">%from = %to -&gt; ledger = before.ledger</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on ledger when <code>%from</code> is equal to <code>%to</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="unchanged-ledger-records"></a>Unchanged <code>ledger</code> records<a class="hash-link" href="#unchanged-ledger-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">forall tokenholder in ledger,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">tokenholder.holder &lt;&gt; %from -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">tokenholder.holder &lt;&gt; %to -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">before.ledger[tokenholder.holder] = some(tokenholder)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Tokenholders other than <code>%from</code> and <code>%to</code>, are not modified nor added to ledger.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="removed-ledger-records"></a>Removed <code>ledger</code> records<a class="hash-link" href="#removed-ledger-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">removed.ledger.isempty()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No record is removed from ledger.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="added-ledger-records"></a>Added <code>ledger</code> records<a class="hash-link" href="#added-ledger-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some before_to = before.ledger[%to] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  added.ledger.isempty()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  added.ledger = [ { holder = %to; tokens = value } ]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The added record in &#x27;ledger&#x27;, if any, is the %to record.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-allowance"></a>Effect on <code>allowance</code><a class="hash-link" href="#effect-on-allowance" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-fromcaller-allowance-record"></a>Effect on <code>(%from,caller)</code> allowance record<a class="hash-link" href="#effect-on-fromcaller-allowance-record" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">caller &lt;&gt; %from -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some before_from_caller = before.allowance[(%from,caller)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some after_from_caller = allowance[(%from,caller)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  before_from_caller.amount &gt; value -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  after_from_caller = { before_from_caller with</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    amount = abs (before_from_caller.amount - value)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise false</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When caller is different from <code>%from</code>, the amount caller is authorised to spend on the behalf of <code>%from</code> is decreased by value if value is striclty greated than the authorized amount.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="no-effect-on-allowance"></a>No effect on allowance<a class="hash-link" href="#no-effect-on-allowance" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">caller = %from -&gt; allowance = before.allowance</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on allowance when caller is equal to <code>%from</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="unchanged-allowance-records"></a>Unchanged allowance records<a class="hash-link" href="#unchanged-allowance-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">forall a in allowance,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">a.addr_owner &lt;&gt; %from and a.addr_spender &lt;&gt; caller -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">before.allowance[(a.addr_owner,a.addr_spender)] = some(a)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Allowed amounts other than those associated to <code>%from</code> and caller are identical.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="added-and-removed-allowance-records"></a>Added and removed allowance records<a class="hash-link" href="#added-and-removed-allowance-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">removed.allowance.isempty() and added.allowance.isempty()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No allowance record is added or removed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="explicit-fail"></a>Explicit fail<a class="hash-link" href="#explicit-fail" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="not-enough-balance"></a>Not Enough Balance<a class="hash-link" href="#not-enough-balance" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">fails with (msg : string) :</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  let some after_ledger_from = ledger[%from] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    msg = &quot;NotEnoughBalance&quot; and</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    after_ledger_from.tokens &lt; value</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  otherwise true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When the entry fails with message &quot;NotEnoughBalance&quot;, value is stricly greater than the number of tokens of <code>%to</code>. Cannot spend more than you own.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="not-enough-allowance"></a>Not Enough Allowance<a class="hash-link" href="#not-enough-allowance" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">fails with (msg : string * (nat * nat)) :</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  let some after_allowance_from_caller = allowance[(%from,caller)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    msg = (&quot;NotEnoughAllowance&quot;, (value, after_allowance_from_caller.amount)) and</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    caller &lt;&gt; %from and</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    after_allowance_from_caller.amount &lt; value</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  otherwise false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When the entry fails with message &quot;NotEnoughAllowance&quot;, caller is different from <code>%from</code> and value is stricly greater than the allowed amount for <code>%from</code> and caller. A spender cannot spend more than allowed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-operations"></a>Effect on operations<a class="hash-link" href="#effect-on-operations" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">length (operations) = 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No operation generated.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="approve"></a>Approve<a class="hash-link" href="#approve" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-ledger-1"></a>Effect on <code>ledger</code><a class="hash-link" href="#effect-on-ledger-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">ledger = before.ledger</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on ledger.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-allowance-1"></a>Effect on <code>allowance</code><a class="hash-link" href="#effect-on-allowance-1" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-callerspender-allowance-record"></a>Effect on <code>(caller,spender)</code> allowance record<a class="hash-link" href="#effect-on-callerspender-allowance-record" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some after_allowance_caller_spender = allowance[(caller,spender)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some before_allowance_caller_spender = before.allowance[(caller,spender)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  after_allowance_caller_spender = { before_allowance_caller_spender with</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    amount = value</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  after_allowance_caller_spender = {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    addr_owner = caller;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    addr_spender = spender;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    amount = value</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Allowed amount of tokens spendable by spender on the behalf of caller is set to value.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="unchanged-allowance-records-1"></a>Unchanged allowance records<a class="hash-link" href="#unchanged-allowance-records-1" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">forall a in allowance,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">(a.addr_owner, a.addr_spender) &lt;&gt; (caller, spender) -&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">before.allowance[(a.addr_owner, a.addr_spender)] = some(a)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Other allowed amounts than the allowed amount of tokens spendable by spender on the behalf of caller, are unchanged.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="added-allowance-records"></a>Added allowance records<a class="hash-link" href="#added-allowance-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some allowance_caller_spender = before.allowance[(caller, spender)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  added.allowance.isempty()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  added.allowance = [ { addr_owner = caller; addr_spender = spender; amount = value } ]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">The added allowance record, if any, is the caller and spender one.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="removed-allowance-records"></a>Removed allowance records<a class="hash-link" href="#removed-allowance-records" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">removed.allowance.isempty()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No record is removed from allowance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="explicit-fail-1"></a>Explicit fail<a class="hash-link" href="#explicit-fail-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">fails with (msg : (string * nat)) :</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">let some allowance_caller_spender = allowance[(caller,spender)] in</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  msg = (&quot;UnsafeAllowanceChange&quot;, allowance_caller_spender.amount) and</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  value &gt; 0 and</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  allowance_caller_spender.amount &gt; 0</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">otherwise false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When the entry fails with message &quot;UnsafeAllowanceChange&quot;, value is strictly greater than 0 and the allowed amount of tokens spendable by spender on the behalf of caller is not equal to zero.
Note that in that case, it may be set back to 0 by having spender call the transfer entry to transfer a number of tokens equal to the remaining allowed amount, from the approver address (ie caller above) to the approver address (ie to itself).
Indeed, according to properties 1.3 and 2.1 of the transfer entry, this has no effect on ledger and sets allowance record to 0.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-operations-1"></a>Effect on operations<a class="hash-link" href="#effect-on-operations-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">length (operations) = 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No operation generated.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="get-allowance"></a>Get allowance<a class="hash-link" href="#get-allowance" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-ledger-2"></a>Effect on <code>ledger</code><a class="hash-link" href="#effect-on-ledger-2" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">ledger = before.ledger</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on ledger.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-allowance-2"></a>Effect on <code>allowance</code><a class="hash-link" href="#effect-on-allowance-2" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">allowance = before.allowance</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on allowance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="explicit-fail-2"></a>Explicit fail<a class="hash-link" href="#explicit-fail-2" title="Direct link to heading">#</a></h3><p>No explicit fail. The entry implicitely fails though if the provided callback is invalid.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-operations-2"></a>Effect on operations<a class="hash-link" href="#effect-on-operations-2" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">length (operations) = 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Creates one callback operation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="get-balance"></a>Get balance<a class="hash-link" href="#get-balance" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-ledger-3"></a>Effect on <code>ledger</code><a class="hash-link" href="#effect-on-ledger-3" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">ledger = before.ledger</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on ledger.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-allowance-3"></a>Effect on <code>allowance</code><a class="hash-link" href="#effect-on-allowance-3" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">allowance = before.allowance</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on allowance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="explicit-fail-3"></a>Explicit fail<a class="hash-link" href="#explicit-fail-3" title="Direct link to heading">#</a></h3><p>No explicit fail. The entry implicitely fails though if the provided callback is invalid.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-operations-3"></a>Effect on operations<a class="hash-link" href="#effect-on-operations-3" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">length (operations) = 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Creates one callback operation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="get-total-supply"></a>Get total supply<a class="hash-link" href="#get-total-supply" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-ledger-4"></a>Effect on <code>ledger</code><a class="hash-link" href="#effect-on-ledger-4" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">ledger = before.ledger</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on ledger.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-allowance-4"></a>Effect on <code>allowance</code><a class="hash-link" href="#effect-on-allowance-4" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">allowance = before.allowance</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>No effect on allowance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="explicit-fail-4"></a>Explicit fail<a class="hash-link" href="#explicit-fail-4" title="Direct link to heading">#</a></h3><p>No explicit fail. The entry implicitely fails though if the provided callback is invalid.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="effect-on-operations-4"></a>Effect on operations<a class="hash-link" href="#effect-on-operations-4" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">length (operations) = 1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Creates one callback operation.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/edukera/completium-landing/tree/master/docs/dapp-dex/dex13.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#invariant" class="table-of-contents__link">Invariant</a></li><li><a href="#transfer" class="table-of-contents__link">Transfer</a><ul><li><a href="#effect-on-ledger" class="table-of-contents__link">Effect on <code>ledger</code></a></li><li><a href="#effect-on-allowance" class="table-of-contents__link">Effect on <code>allowance</code></a></li><li><a href="#explicit-fail" class="table-of-contents__link">Explicit fail</a></li><li><a href="#effect-on-operations" class="table-of-contents__link">Effect on operations</a></li></ul></li><li><a href="#approve" class="table-of-contents__link">Approve</a><ul><li><a href="#effect-on-ledger-1" class="table-of-contents__link">Effect on <code>ledger</code></a></li><li><a href="#effect-on-allowance-1" class="table-of-contents__link">Effect on <code>allowance</code></a></li><li><a href="#explicit-fail-1" class="table-of-contents__link">Explicit fail</a></li><li><a href="#effect-on-operations-1" class="table-of-contents__link">Effect on operations</a></li></ul></li><li><a href="#get-allowance" class="table-of-contents__link">Get allowance</a><ul><li><a href="#effect-on-ledger-2" class="table-of-contents__link">Effect on <code>ledger</code></a></li><li><a href="#effect-on-allowance-2" class="table-of-contents__link">Effect on <code>allowance</code></a></li><li><a href="#explicit-fail-2" class="table-of-contents__link">Explicit fail</a></li><li><a href="#effect-on-operations-2" class="table-of-contents__link">Effect on operations</a></li></ul></li><li><a href="#get-balance" class="table-of-contents__link">Get balance</a><ul><li><a href="#effect-on-ledger-3" class="table-of-contents__link">Effect on <code>ledger</code></a></li><li><a href="#effect-on-allowance-3" class="table-of-contents__link">Effect on <code>allowance</code></a></li><li><a href="#explicit-fail-3" class="table-of-contents__link">Explicit fail</a></li><li><a href="#effect-on-operations-3" class="table-of-contents__link">Effect on operations</a></li></ul></li><li><a href="#get-total-supply" class="table-of-contents__link">Get total supply</a><ul><li><a href="#effect-on-ledger-4" class="table-of-contents__link">Effect on <code>ledger</code></a></li><li><a href="#effect-on-allowance-4" class="table-of-contents__link">Effect on <code>allowance</code></a></li><li><a href="#explicit-fail-4" class="table-of-contents__link">Explicit fail</a></li><li><a href="#effect-on-operations-4" class="table-of-contents__link">Effect on operations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/dapp-first">First Dapp</a></li><li class="footer__item"><a class="footer__link-item" href="/dapps">DApps</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contract">Smart Contract</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/templates">Contract Templates</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/verification">Formal Verification</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cli">CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dapp-tools/">Technical Stack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://archetype-lang.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archetype</a></li><li class="footer__item"><a href="https://www.edukera.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Edukera</a></li><li class="footer__item"><a href="https://github.com/edukera/completium-landing" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Edukera, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.822531e8.js"></script>
<script src="/runtime~main.c55d65e3.js"></script>
<script src="/main.aa5006cf.js"></script>
<script src="/common.98521b8c.js"></script>
<script src="/2.10289d19.js"></script>
<script src="/168.71275521.js"></script>
<script src="/169.1de35d87.js"></script>
<script src="/935f2afb.e6d3db93.js"></script>
<script src="/163.3f948697.js"></script>
<script src="/1bc7cd5f.5f783aea.js"></script>
</body>
</html>