<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Completium Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Completium Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-react-helmet="true">Escrow | Completium</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Escrow | Completium"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/templates/escrow"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/templates/escrow"><link rel="stylesheet" href="/styles.12545298.css">
<link rel="preload" href="/styles.822531e8.js" as="script">
<link rel="preload" href="/runtime~main.99ffecb8.js" as="script">
<link rel="preload" href="/main.cfed5107.js" as="script">
<link rel="preload" href="/common.59d22858.js" as="script">
<link rel="preload" href="/2.e39e4ca6.js" as="script">
<link rel="preload" href="/156.d9786be6.js" as="script">
<link rel="preload" href="/157.7b3b799a.js" as="script">
<link rel="preload" href="/935f2afb.0bd2e1e3.js" as="script">
<link rel="preload" href="/151.0de276cd.js" as="script">
<link rel="preload" href="/244f24ed.5a101653.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/dapp-first">First DApp</a><a class="navbar__item navbar__link" href="/dapps">DApps</a><a class="navbar__item navbar__link" href="/docs/contract">Smart Contract</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/templates">Contract Templates</a><a class="navbar__item navbar__link" href="/docs/cli">CLI</a><a class="navbar__item navbar__link" href="/docs/dapp-tools">Technical stack</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/edukera/completium-landing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dapp-first">First DApp</a></li><li class="menu__list-item"><a class="menu__link" href="/dapps">DApps</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/contract">Smart Contract</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/templates">Contract Templates</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dapp-tools">Technical stack</a></li><li class="menu__list-item"><a href="https://github.com/edukera/completium-landing" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/templates">Presentation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Fungible Token</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/fa12">FA 1.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/erc20">ERC20</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Non-Fungible Token</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/nft">FA 2</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DeFi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/dex">DEX</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/ico">ICO</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/zcb">Zero-Coupon bond</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/acn">Autocallable note</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Governance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/ideabox">Idea box</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/competition">Competition</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/auction">Auction</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Payment</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/templates/escrow">Escrow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/templates/miles">Miles</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Insurance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/healthcare">Health care</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/templates/fizzy">Fizzy</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Escrow</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The escrow smart contract establishes a decentralized purchase process between the seller and buyer. The principle is that the price amount is escrowed in the smart contract and released when the purchased item is received by buyer.</p><p>The critical point of the process is that it requires actions from the buyer and the seller to complete the process:</p><ul><li>if the seller does not send the item, buyer&#x27;s fund are locked in the escrow</li><li>if the buyer does not complete the process, even if the item is received, then the seller does not reveive payment</li></ul><p>In order to motivate both the seller and the buyer to execute the process, the basic idea is that they fund the escrow with <em>security deposits</em> that are transferred back only if the process is complete. In the escrow presented here, security deposits are a proportion of the price of the item.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="api"></a>API<a class="hash-link" href="#api" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="storage"></a>Storage<a class="hash-link" href="#storage" title="Direct link to heading">#</a></h3><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>seller</code></td><td><code>address</code></td><td>Seller&#x27;s address.</td></tr><tr><td><code>buyer</code></td><td><code>address</code></td><td>Buyer&#x27;s address.</td></tr><tr><td><code>taxcollecter</code></td><td><code>address</code></td><td>Tax collector&#x27;s address.</td></tr><tr><td><code>price</code></td><td><code>tez</code></td><td>Amount of transaction.</td></tr><tr><td><code>taxrate</code></td><td><code>rational</code></td><td>Tax rate applied to <code>price</code></td></tr><tr><td><code>securityrate</code></td><td><code>rational</code></td><td>Security rate applied to <code>price</code> for security deposit.</td></tr><tr><td><code>_state</code></td><td><code>states</code></td><td>Escrow state, one of <code>Create</code>, <code>Aborted</code>, <code>Funded</code>, <code>Completed</code></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="entrypoints"></a>Entrypoints<a class="hash-link" href="#entrypoints" title="Direct link to heading">#</a></h3><table><thead><tr><th>Name</th><th>Parameters</th><th>Description</th></tr></thead><tbody><tr><td><code>abort</code></td><td></td><td><code>buyer</code> and <code>seller</code> can abort escrow in <code>Created</code> state.</td></tr><tr><td><code>toFunded</code></td><td></td><td>Internally called by escrow to go to <code>Funded</code> state.</td></tr><tr><td><code>fund</code></td><td></td><td>Called by <code>buyer</code> and <code>seller</code> to provide funds:<ul><li><code>buyer</code> must transfer price, security deposit and taxes </li><li><code>seller</code> must transfer security deposit.</li></ul></td></tr><tr><td><code>complete</code></td><td></td><td>Called by <code>buyer</code> when purchased item is received. This transfers:<ul><li>item price and security deposit to <code>seller</code></li><li>security deposit to <code>buyer</code></li><li>tax to <code>taxcollector</code></li></ul></td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="code"></a>Code<a class="hash-link" href="#code" title="Direct link to heading">#</a></h2><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1shy tabs__item--active">Archetype</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1shy">Michelson</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="mdxCodeBlock_1zKU"><div style="color:#F8F8F2;background-color:#282A36" class="codeBlockTitle_2eSY">escrow.arl</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-archetype codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">archetype escrow(</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">seller       : role,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">buyer        : role,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">taxcollector : role,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">price        : tez,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">taxrate      : rational,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">securityrate : rational,</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">variable buyer_funded  : bool = false</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">variable seller_funded : bool = false</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">(* states *)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">states =</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> | Created initial</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> | Aborted</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> | Funded</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> | Completed</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">transition abort () {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  called by buyer or seller</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  from Created to Aborted</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">transition toFunded () {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  called by selfaddress</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  from Created to Funded</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">entry fund () {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  called by buyer or seller</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  effect {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    if caller = buyer then begin</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      dorequire(transferred &gt;= (1 + taxrate + securityrate) * price, &quot;NOT_ENOUGH_FUND&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      buyer_funded := true</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    end else if caller = seller then begin</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      dorequire(transferred &gt;= securityrate * price, &quot;NOT_ENOUGH_FUND&quot;);</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      seller_funded := true</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    end;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    if buyer_funded and seller_funded then</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      transfer 0tz to entry self.toFunded()</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">transition complete () {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  called by buyer</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  from Funded to Completed</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  with effect {</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    transfer ((1 + securityrate) * price) to seller;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    transfer (securityrate * price)       to buyer;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    if taxrate &gt; 0 then</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      transfer (taxrate * price)          to taxcollector;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="mdxCodeBlock_1zKU"><code class="language-js"></code></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/templates/template11.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/templates/auction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Auction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/templates/miles"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Miles »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#api" class="table-of-contents__link">API</a><ul><li><a href="#storage" class="table-of-contents__link">Storage</a></li><li><a href="#entrypoints" class="table-of-contents__link">Entrypoints</a></li></ul></li><li><a href="#code" class="table-of-contents__link">Code</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/dapp-first">First Dapp</a></li><li class="footer__item"><a class="footer__link-item" href="/dapps">DApps</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contract">Smart Contract</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/templates">Contract Templates</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cli">CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dapp-tools/">Technical Stack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://archetype-lang.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archetype</a></li><li class="footer__item"><a href="https://www.edukera.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Edukera</a></li><li class="footer__item"><a href="https://github.com/edukera/completium-landing" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Edukera, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.822531e8.js"></script>
<script src="/runtime~main.99ffecb8.js"></script>
<script src="/main.cfed5107.js"></script>
<script src="/common.59d22858.js"></script>
<script src="/2.e39e4ca6.js"></script>
<script src="/156.d9786be6.js"></script>
<script src="/157.7b3b799a.js"></script>
<script src="/935f2afb.0bd2e1e3.js"></script>
<script src="/151.0de276cd.js"></script>
<script src="/244f24ed.5a101653.js"></script>
</body>
</html>