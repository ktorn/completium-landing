(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{218:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return l})),a.d(t,"metadata",(function(){return b})),a.d(t,"toc",(function(){return p})),a.d(t,"default",(function(){return d}));var n=a(3),i=(a(0),a(235)),c=a(236),r=a(238),o=a(239);const l={id:"miles7",title:"Contract setup",sidebar_label:"Contract setup",slug:"/dapp-miles/miles-tg-contract"},b={unversionedId:"dapp-miles/miles7",id:"dapp-miles/miles7",isDocsHomePage:!1,title:"Contract setup",description:"The smart contract is at this location:",source:"@site/docs/dapp-miles/miles7.md",slug:"/dapp-miles/miles-tg-contract",permalink:"/docs/dapp-miles/miles-tg-contract",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/dapp-miles/miles7.md",version:"current",sidebar_label:"Contract setup",sidebar:"dapps",previous:{title:"Presentation",permalink:"/docs/dapp-miles/miles-tg-overview"},next:{title:"Interactions with contract",permalink:"/docs/dapp-miles/miles-tg-interactions"}},p=[{value:"Origination",id:"origination",children:[]},{value:"Add miles",id:"add-miles",children:[]},{value:"Skip this step?",id:"skip-this-step",children:[]}],s={toc:p};function d({components:e,...t}){return Object(i.b)("wrapper",Object(n.a)({},s,t,{components:e,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The smart contract is at this location:"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"~/completium-dapp-miles/contract/miles_with_expiration.arl")),Object(i.b)("p",null,"The contract is written in ",Object(i.b)("a",{href:"https://archetype-lang.org/"},"Archetype")," language. Go to the Smart contract section for a detailed presentation."),Object(i.b)("p",null,"The setup consists in deploying the contract and adding mile to the user account."),Object(i.b)("h2",{id:"origination"},"Origination"),Object(i.b)("p",null,"Open the ",Object(i.b)(c.a,{to:"/docs/dapp-tools/gitpod#open-terminal",mdxType:"Link"},"terminal")," and enter the following command line to originate (deploy) the smart contract is:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"completium-cli deploy ./contract/miles_with_expiration.arl --named miles\n")),Object(i.b)("p",null,"The ",Object(i.b)(c.a,{to:"/docs/cli/contract#deploy--originate",mdxType:"Link"},"originate command")," triggers two operations:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"the contract compilation to Michelson with archetype compiler"),Object(i.b)("li",{parentName:"ul"},"the Michelson contract origination with Tezos client")),Object(i.b)("p",null,"The contract may then be referred to as ",Object(i.b)("inlineCode",{parentName:"p"},"miles")," in future interactions."),Object(i.b)("p",null,"If you are using the preset ",Object(i.b)(c.a,{to:"/docs/dapp-tools/gitpod",mdxType:"Link"},"Gitpod")," environement, note that ",Object(i.b)(c.a,{to:"/docs/cli",mdxType:"Link"},"completium-cli")," is pre-installed with the ",Object(i.b)(c.a,{to:"/docs/dapp-tools/faucet#admin-account",mdxType:"Link"},"admin")," account. See this section for more information."),Object(i.b)("p",null,"The address of the newly originated contract is visible in the command output, as illustrated below:"),Object(i.b)(r.a,{img:"miles-newcontract.png",mdxType:"DappFigure"}),Object(i.b)("p",null,"A smart contract address starts with ",Object(i.b)("inlineCode",{parentName:"p"},"KT1"),". In the situation above, the new contract's address is ",Object(i.b)("inlineCode",{parentName:"p"},"KT19TYkVxnUb1m9DoWbSASqY6XQdVLQFCK8F"),"."),Object(i.b)("p",null,"You may got to ",Object(i.b)(c.a,{to:"/docs/dapp-tools/bcd",mdxType:"Link"},"Better call dev")," contract explorer to check it:"),Object(i.b)(o.a,{url:"https://better-call.dev/",txt:"go to better call dev",mdxType:"DappButton"}),Object(i.b)("p",null,"The new contract address needs to be set in the DApp's ",Object(i.b)("inlineCode",{parentName:"p"},"src/settings.js")," file:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),'/////////////////////////////////////////////////////////////////////////////\n// FIX ME\n// set new contract address\n/////////////////////////////////////////////////////////////////////////////\nexport const  contractAddress = "KT1F5DqPwKJC9qeEjTgdEQKGGBZpcAv5DX86"\n')),Object(i.b)("h2",{id:"add-miles"},"Add miles"),Object(i.b)("p",null,"In order to provide miles to a user, the amdin must call the 'add' entry point of the contract."),Object(i.b)("p",null,"If you don't have a user account, follow these ",Object(i.b)(c.a,{to:"/docs/dapp-tools/faucet#create-test-account",mdxType:"Link"},"instructions")," to get one."),Object(i.b)("p",null,"The entry point signature is presented below:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-archetype"}),"entry add (ow                 : address,\n           newmile_id         : string,\n           newmile_amount     : int,\n           newmile_expiration : date) {\n   called by admin\n   effect {\n     ...\n   }\n}\n")),Object(i.b)("p",null,"Parameters are presented below:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Parameter"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"center"}),"Value"),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"right"}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ow"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"USER_ADDRESS"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"right"}),"address of the miles' owner, for example '@tz1MZrh8CvYkp7BfLQMcm6mg5FvL5HRZfACw'")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"newmile_id"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),'USER_ADDRESS + "_0"'),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"right"}),"a unique identifier for the created miles, for example 'tz1MZrh8CvYkp7BfLQMcm6mg5FvL5HRZfACw_0'")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"newmile_amount"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"20"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"right"}),"number of miles to create")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"newmile_expiration"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"center"}),"TOMORROW"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"right"}),"date beyond which miles are expired, for example '2021-06-28'")))),Object(i.b)("p",null,"where:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"USER_ADDRESS is replaced by the DApp user account to receive the miles"),Object(i.b)("li",{parentName:"ul"},"TOMORROW is replaced by a date in the future, for example tomorrow")),Object(i.b)("p",null,"In the ",Object(i.b)(c.a,{to:"/docs/dapp-tools/gitpod#open-terminal",mdxType:"Link"},"terminal")," enter the following command:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"completium-cli call miles --entry add\n        --with '(<USER_ADDRESS>, \"mileid\", 20, 2021-06-28)'\n")),Object(i.b)("h2",{id:"skip-this-step"},"Skip this step?"),Object(i.b)("p",null,"It is possible to skip this phase and use the contract already deployed for the demo, and available at the following address:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"KT1F5DqPwKJC9qeEjTgdEQKGGBZpcAv5DX86\n")),Object(i.b)(o.a,{url:"https://better-call.dev/delphinet/KT1F5DqPwKJC9qeEjTgdEQKGGBZpcAv5DX86/operations",txt:"open in better call dev",mdxType:"DappButton"}),Object(i.b)("p",null,"Go to the ",Object(i.b)(c.a,{to:"/docs/dapp-miles/create-miles#miles-creation-transaction",mdxType:"Link"},"use case")," section to know how to add miles for your user account."))}d.isMDXComponent=!0}}]);