(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{143:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return b})),n.d(t,"default",(function(){return m}));var a=n(3),c=n(7),i=(n(0),n(224)),l=n(227),r=n(225),o={id:"tuto6",title:"State Machine",sidebar_label:"6. State Machine",slug:"/contract/tuto/archetype-statem",hide_title:!0},s={unversionedId:"contract/tuto/tuto6",id:"contract/tuto/tuto6",isDocsHomePage:!1,title:"State Machine",description:"State machine",source:"@site/docs/contract/tuto/tuto6.md",slug:"/contract/tuto/archetype-statem",permalink:"/docs/contract/tuto/archetype-statem",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/contract/tuto/tuto6.md",version:"current",sidebar_label:"6. State Machine",sidebar:"contract",previous:{title:"Date arithmetic",permalink:"/docs/contract/tuto/archetype-datearith"},next:{title:"Assets",permalink:"/docs/contract/tuto/archetype-assets"}},b=[{value:"State machine",id:"state-machine",children:[{value:"Deploy",id:"deploy",children:[]},{value:"Call entry points",id:"call-entry-points",children:[]},{value:"Next",id:"next",children:[]}]}],p={toc:b};function m(e){var t=e.components,n=Object(c.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"state-machine"},"State machine"),Object(i.b)("p",null,"It is possible to design the smart contract as a state machine which is convenient for ease of read."),Object(i.b)("p",null,"In this exercise, the machine has 4 states and 3 transitions as illustrated in the shcema below:"),Object(i.b)(l.a,{img:"tuto_statem.svg",width:"60%",mdxType:"DappFigure"}),Object(i.b)("p",null,"Transitions have conditions:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"goes in InProgress state if balance is greater than 3tz"),Object(i.b)("li",{parentName:"ul"},"complete if internal ",Object(i.b)("inlineCode",{parentName:"li"},"value")," is strictly greater than 1 (requires calls to ",Object(i.b)("inlineCode",{parentName:"li"},"inc_value"),")")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype",metastring:'title="6-state_machine.arl"',title:'"6-state_machine.arl"'}),"archetype state_machine\n\nstates =\n| Created initial\n| InProgress\n| Interrupted\n| Completed\n\nvariable value : nat = 0\n\nentry inc_value () {\n  value += 1\n}\n\ntransition init () {\n  from Created to InProgress\n  when { transferred > 3tz }\n  with effect { () /* nothing */}\n}\n\ntransition complete () {\n  from InProgress to Completed\n  when { value > 1 }\n  with effect { transfer balance to caller }\n}\n\ntransition interrupt () {\n  from InProgress to Interrupted\n  with effect { transfer (50% * balance) to caller }\n}\n")),Object(i.b)("p",null,"Each transition is a contract entry point."),Object(i.b)("h3",{id:"deploy"},"Deploy"),Object(i.b)("p",null,"The following ",Object(i.b)(r.a,{to:"/docs/cli",mdxType:"Link"},"Completium CLI")," command deploys the contract on the Tezos network:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli deploy 6-state_machine.arl\n")),Object(i.b)("h3",{id:"call-entry-points"},"Call entry points"),Object(i.b)("p",null,"In this example it is necessary to call specific entry points. A contract's entrypoints may be listed with:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli show entries 6-state_machine\n")),Object(i.b)("p",null,"The goal here is to set the state machine to ",Object(i.b)("inlineCode",{parentName:"p"},"Completed")," state. Use the following commands to transit the machine:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli call 6-state_machine --entry init --amount 5tz\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli call 6-state_machine --entry inc_value\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli call 6-state_machine --entry inc_value\n")),Object(i.b)("p",null,"At this stage, ",Object(i.b)("inlineCode",{parentName:"p"},"value")," is ",Object(i.b)("inlineCode",{parentName:"p"},"2"),", which allows transiting to ",Object(i.b)("inlineCode",{parentName:"p"},"Completed"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli call 6-state_machine --entry complete\n")),Object(i.b)("p",null,"This last call may be replaced by the following command to go to ",Object(i.b)("inlineCode",{parentName:"p"},"Interrupted")," state:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"completium-cli call 6-state_machine --entry interrupt\n")),Object(i.b)("h3",{id:"next"},"Next"),Object(i.b)("p",null,"Open '7-assets.arl' and click on \"Next: Assets\" below."))}m.isMDXComponent=!0}}]);