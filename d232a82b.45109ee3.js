(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{198:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return d})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(7),i=(n(0),n(224)),c=n(225),b=n(240),s=n(241),o={id:"template9",title:"Competition",sidebar_label:"Competition",slug:"/templates/competition"},l={unversionedId:"templates/template9",id:"templates/template9",isDocsHomePage:!1,title:"Competition",description:"Introduction",source:"@site/docs/templates/template9.md",slug:"/templates/competition",permalink:"/docs/templates/competition",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/templates/template9.md",version:"current",sidebar_label:"Competition",sidebar:"templates",previous:{title:"Idea box",permalink:"/docs/templates/ideabox"},next:{title:"Auction",permalink:"/docs/templates/auction"}},d=[{value:"Introduction",id:"introduction",children:[]},{value:"API",id:"api",children:[{value:"Storage",id:"storage",children:[]},{value:"Entrypoints",id:"entrypoints",children:[]}]},{value:"Code",id:"code",children:[]}],m={toc:d};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},m,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"introduction"},"Introduction"),Object(i.b)("p",null,"This contract collects competitors' scores, and distribute prize to top scores. Submitted scores must be signed by an external oracle to be registered."),Object(i.b)("p",null,"You may see this contract in action in the ",Object(i.b)(c.a,{to:"/docs/dapp-game/",mdxType:"Link"},"2048 competition")," DApp example."),Object(i.b)("h2",{id:"api"},"API"),Object(i.b)("h3",{id:"storage"},"Storage"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Name"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Type"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"organizer")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Address of the organizer.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"prize")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"tez")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Prize value in tez.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"oracle")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"key")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Key of the score oracle.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"submission")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"collection")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"A submission is defined by:",Object(i.b)("ul",null,Object(i.b)("li",null,"a competitor address"),Object(i.b)("li",null,"a score"),Object(i.b)("li",null,"a timestamp")))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"_state")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"states")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Contract state, one of ",Object(i.b)("inlineCode",{parentName:"td"},"Created"),", ",Object(i.b)("inlineCode",{parentName:"td"},"InProgress"),", ",Object(i.b)("inlineCode",{parentName:"td"},"Closed"),".")))),Object(i.b)("h3",{id:"entrypoints"},"Entrypoints"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Name"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameters"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"confirmed")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(i.b)("inlineCode",{parentName:"td"},"organizer")," to open the competition. Prize must be transferred.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"submit")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"packed_score"),", ",Object(i.b)("inlineCode",{parentName:"td"},"signed_score")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Adds a submission; ",Object(i.b)("inlineCode",{parentName:"td"},"packed_score")," is packed version of the pair ",Object(i.b)("em",{parentName:"td"},"competitor address")," and ",Object(i.b)("em",{parentName:"td"},"score"),"; ",Object(i.b)("inlineCode",{parentName:"td"},"signed_score")," is this packed data signed by ",Object(i.b)("inlineCode",{parentName:"td"},"oracle"),". ",Object(i.b)("p",null),"It fails if the data is not signed by ",Object(i.b)("inlineCode",{parentName:"td"},"oracle"),"; it updates the score of the competitor if score already exists.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"close")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Sets contract state to ",Object(i.b)("inlineCode",{parentName:"td"},"Closed")," and distribute prize to top scores: ",Object(i.b)("ul",null,Object(i.b)("li",null,Object(i.b)("em",{parentName:"td"},"50%"),", ",Object(i.b)("em",{parentName:"td"},"30%"),", ",Object(i.b)("em",{parentName:"td"},"20%")," if more than 3 submissions"),Object(i.b)("li",null,Object(i.b)("em",{parentName:"td"},"60%"),", ",Object(i.b)("em",{parentName:"td"},"40%")," if 2 submissions"),Object(i.b)("li",null,Object(i.b)("em",{parentName:"td"},"100%")," if only one submission")))))),Object(i.b)("h2",{id:"code"},"Code"),Object(i.b)(b.a,{defaultValue:"archetype",values:[{label:"Archetype",value:"archetype"},{label:"Michelson",value:"michelson"}],mdxType:"Tabs"},Object(i.b)(s.a,{value:"archetype",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype",metastring:'title="competition.arl"',title:'"competition.arl"'}),'archetype competition(\n  organizer   : address,\n  prize       : tez,\n  oracle      : key,\n)\n\nasset submission {\n  competitor : address;\n  score      : nat;\n  timestamp  : date;\n}\n\n(* state machine *)\nstates =\n | Created     initial\n | InProgress\n | Closed\n\ntransition confirm () {\n  called by organizer\n  from Created to InProgress\n  when { transferred = prize }\n}\n\nentry submit (packed_score : bytes, signed_score : signature) {\n  require {\n    c1 : state = InProgress;\n  }\n  effect {\n    if check_signature(oracle, signed_score, packed_score) then (\n      match unpack<address * nat>(packed_score) with\n      | some(s) ->\n        submission.addupdate(s[0], {\n          score = s[1];\n          timestamp = now\n        })\n      | none -> fail("CANNOT_UNPACK_SCORE")\n      end\n    ) else fail("NOT_SIGNED_BY_ORACLE");\n  }\n}\n\ntransition close () {\n  called by organizer\n  from InProgress to Closed\n  with effect {\n    var submissions = submission.sort(desc(score), timestamp);\n    if submissions.count() >= 3 then begin\n      var first  = submissions.nth(0);\n      var second = submissions.nth(1);\n      var third  = submissions.nth(2);\n      var q1 = 50% * prize;\n      var q2 = 30% * prize;\n      var q3 = 20% * prize;\n      transfer q1 to first;\n      transfer q2 to second;\n      transfer q3 to third;\n      transfer (prize - q1 - q2 - q3) to organizer\n    end else if submissions.count() >= 2 then begin\n      var first  = submissions.nth(0);\n      var second = submissions.nth(1);\n      var q1 = 60% * prize;\n      var q2 = 40% * prize;\n      transfer q1 to first;\n      transfer q2 to second;\n      transfer (prize - q1 - q2) to organizer\n    end else if submissions.count() >= 1 then begin\n      var first = submissions.nth(0);\n      transfer prize to first\n    end else transfer prize to organizer\n  }\n}\n'))),Object(i.b)(s.a,{value:"michelson",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"")))))}p.isMDXComponent=!0},233:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},238:function(e,t,n){"use strict";var a=n(0),r=n(239);t.a=function(){const e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},239:function(e,t,n){"use strict";var a=n(0);const r=Object(a.createContext)(void 0);t.a=r},240:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(238),c=n(233),b=n(56),s=n.n(b);const o=37,l=39;t.a=function(e){const{lazy:t,block:n,defaultValue:b,values:d,groupId:m,className:p}=e,{tabGroupChoices:u,setTabGroupChoices:O}=Object(i.a)(),[j,N]=Object(a.useState)(b),f=a.Children.toArray(e.children);if(null!=m){const e=u[m];null!=e&&e!==j&&d.some((t=>t.value===e))&&N(e)}const g=e=>{N(e),null!=m&&O(m,e)},h=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(c.a)("tabs",{"tabs--block":n},p)},d.map((({value:e,label:t})=>r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":j===e,className:Object(c.a)("tabs__item",s.a.tabItem,{"tabs__item--active":j===e}),key:e,ref:e=>h.push(e),onKeyDown:e=>{((e,t,n)=>{switch(n.keyCode){case l:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case o:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(h,e.target,e)},onFocus:()=>g(e),onClick:()=>{g(e)}},t)))),t?Object(a.cloneElement)(f.filter((e=>e.props.value===j))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},f.map(((e,t)=>Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==j})))))}},241:function(e,t,n){"use strict";var a=n(3),r=n(0),i=n.n(r);t.a=function({children:e,hidden:t,className:n}){return i.a.createElement("div",Object(a.a)({role:"tabpanel"},{hidden:t,className:n}),e)}}}]);