(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{205:function(e,n,t){"use strict";t(0),t(209)},84:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return d})),t.d(n,"default",(function(){return b}));var a=t(3),i=t(7),r=(t(0),t(204)),s=(t(205),t(207),t(208),{id:"zcb9",title:"Implementation",sidebar_label:"Implementation",slug:"/dapp-zcb/implementation"}),c={unversionedId:"dapp-zcb/zcb9",id:"dapp-zcb/zcb9",isDocsHomePage:!1,title:"Implementation",description:"Sign",source:"@site/docs/dapp-zcb/zcb9.md",slug:"/dapp-zcb/implementation",permalink:"/docs/dapp-zcb/implementation",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/dapp-zcb/zcb9.md",version:"current",sidebar_label:"Implementation",sidebar:"zcb",previous:{title:"Interface",permalink:"/docs/dapp-zcb/interface"}},d=[{value:"Sign",id:"sign",children:[]},{value:"Terminate",id:"terminate",children:[]},{value:"Dispute",id:"dispute",children:[]}],o={toc:d};function b(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},o,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"sign"},"Sign"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"sign")," entry point tests whether the caller is a signer:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype",metastring:"{2,4,11}","{2,4,11}":!0}),'entry sign () {\n  if caller = issuer then\n    issuersigned := true\n  else if caller = subscriber then begin\n    subscribersigned := true;\n    var presentvalue = (1 - discount) * facevalue;\n    dorequire(transferred >= presentvalue, "SUBSCRIBER_INVALID_TRANSFERRED");\n    transfer presentvalue to issuer;\n  end else fail("CALLER_NOT_A_SIGNER");\n  if issuersigned and subscribersigned then\n    transfer 0tz to entry self.toSigned();\n}\n')),Object(r.b)("p",null,"If parties have signed, the transition to ",Object(r.b)("em",{parentName:"p"},"Signed")," is triggered with an internal call to ",Object(r.b)("inlineCode",{parentName:"p"},"toSigned")," (line 12)."),Object(r.b)("h2",{id:"terminate"},"Terminate"),Object(r.b)("p",null,"Transition to ",Object(r.b)("em",{parentName:"p"},"Terminated")," is validated if transferred amount and date are valid:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype",metastring:"{6,7}","{6,7}":!0}),"transition terminate () {\n  called by issuer\n  from Signed to Terminated when {\n    match signaturedate with\n    | some(s) ->\n      s + maturityduration <= now <= s + maturityduration + paybackduration and\n      transferred >= facevalue\n    | none -> false\n    end\n  } with effect {\n    transfer facevalue to subscriber\n  }\n}\n")),Object(r.b)("h2",{id:"dispute"},"Dispute"),Object(r.b)("p",null,"Transition to 'Disputed' is possible if in ",Object(r.b)("em",{parentName:"p"},"Signed")," state after payback period:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype",metastring:"{6}","{6}":!0}),"transition dispute () {\n  called by subscriber\n  from Signed to Disputed when {\n    match signaturedate with\n    | some(d) ->\n      d + maturityduration + paybackduration <=  now\n    | none -> false\n    end\n  }\n}\n")))}b.isMDXComponent=!0}}]);