(self.webpackChunkcompletium_landing=self.webpackChunkcompletium_landing||[]).push([[7398],{6096:function(e,a,n){"use strict";n.r(a),n.d(a,{frontMatter:function(){return d},contentTitle:function(){return c},metadata:function(){return i},toc:function(){return p},default:function(){return s}});var l=n(2122),t=n(9756),o=(n(7294),n(3905)),r=["components"],d={id:"dex13",title:"Specification",sidebar_label:"Specification",slug:"/dapp-dex/specification"},c=void 0,i={unversionedId:"dapp-dex/dex13",id:"dapp-dex/dex13",isDocsHomePage:!1,title:"Specification",description:"Invariant",source:"@site/docs/dapp-dex/dex13.md",sourceDirName:"dapp-dex",slug:"/dapp-dex/specification",permalink:"/docs/dapp-dex/specification",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/dapp-dex/dex13.md",version:"current",frontMatter:{id:"dex13",title:"Specification",sidebar_label:"Specification",slug:"/dapp-dex/specification"}},p=[{value:"Invariant",id:"invariant",children:[]},{value:"Transfer",id:"transfer",children:[{value:"Effect on <code>ledger</code>",id:"effect-on-ledger",children:[]},{value:"Effect on <code>allowance</code>",id:"effect-on-allowance",children:[]},{value:"Explicit fail",id:"explicit-fail",children:[]},{value:"Effect on operations",id:"effect-on-operations",children:[]}]},{value:"Approve",id:"approve",children:[{value:"Effect on <code>ledger</code>",id:"effect-on-ledger-1",children:[]},{value:"Effect on <code>allowance</code>",id:"effect-on-allowance-1",children:[]},{value:"Explicit fail",id:"explicit-fail-1",children:[]},{value:"Effect on operations",id:"effect-on-operations-1",children:[]}]},{value:"Get allowance",id:"get-allowance",children:[{value:"Effect on <code>ledger</code>",id:"effect-on-ledger-2",children:[]},{value:"Effect on <code>allowance</code>",id:"effect-on-allowance-2",children:[]},{value:"Explicit fail",id:"explicit-fail-2",children:[]},{value:"Effect on operations",id:"effect-on-operations-2",children:[]}]},{value:"Get balance",id:"get-balance",children:[{value:"Effect on <code>ledger</code>",id:"effect-on-ledger-3",children:[]},{value:"Effect on <code>allowance</code>",id:"effect-on-allowance-3",children:[]},{value:"Explicit fail",id:"explicit-fail-3",children:[]},{value:"Effect on operations",id:"effect-on-operations-3",children:[]}]},{value:"Get total supply",id:"get-total-supply",children:[{value:"Effect on <code>ledger</code>",id:"effect-on-ledger-4",children:[]},{value:"Effect on <code>allowance</code>",id:"effect-on-allowance-4",children:[]},{value:"Explicit fail",id:"explicit-fail-4",children:[]},{value:"Effect on operations",id:"effect-on-operations-4",children:[]}]}],f={toc:p};function s(e){var a=e.components,n=(0,t.Z)(e,r);return(0,o.kt)("wrapper",(0,l.Z)({},f,n,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"invariant"},"Invariant"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger.sum(tokens) = totalsupply\n")),(0,o.kt)("p",null,"No token is minted: the total number of tokens is equal to the initial totalsupply number of tokens, regardless of the state of the storage."),(0,o.kt)("h2",{id:"transfer"},"Transfer"),(0,o.kt)("p",null,"When the ",(0,o.kt)("inlineCode",{parentName:"p"},"%to")," address is different from the ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," address, the number of tokens ",(0,o.kt)("inlineCode",{parentName:"p"},"%to")," possesses is decread by value."),(0,o.kt)("h3",{id:"effect-on-ledger"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"ledger")),(0,o.kt)("h4",{id:"effect-on-from-token-holder"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h4"},"%from")," token holder"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"%from <> %to ->\nlet some before_ledger_from = before.ledger[%from] in\nlet some after_ledger_from  = ledger[%from] in\n  after_ledger_from = { before_ledger_from with\n    tokens = abs (before_ledger_from.tokens - value)\n  }\notherwise false\notherwise false\n")),(0,o.kt)("h4",{id:"effect-on-to-token-holder"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h4"},"%to")," token holder"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"%from <> %to ->\nlet some after_ledger_to = ledger[%to] in\nlet some before_ledger_to = before.ledger[%to] in\n  after_ledger_to = { before_ledger_to with\n    tokens = (before_ledger_to.tokens + value)\n  }\notherwise\n  after_ledger_to = { holder = %to; tokens = value }\notherwise false\n")),(0,o.kt)("p",null,"When the ",(0,o.kt)("inlineCode",{parentName:"p"},"%to")," address is different from the ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," address, the number of tokens ",(0,o.kt)("inlineCode",{parentName:"p"},"%to")," possesses is increased by value when ",(0,o.kt)("inlineCode",{parentName:"p"},"%to")," is already registered in the ledger, and set to value otherwise. Anyway, ",(0,o.kt)("inlineCode",{parentName:"p"},"%to")," is registered in ledger."),(0,o.kt)("h4",{id:"no-effect-on-ledger"},"No effect on ",(0,o.kt)("inlineCode",{parentName:"h4"},"ledger")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"%from = %to -> ledger = before.ledger\n")),(0,o.kt)("p",null,"No effect on ledger when ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," is equal to ",(0,o.kt)("inlineCode",{parentName:"p"},"%to"),"."),(0,o.kt)("h4",{id:"unchanged-ledger-records"},"Unchanged ",(0,o.kt)("inlineCode",{parentName:"h4"},"ledger")," records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"forall tokenholder in ledger,\ntokenholder.holder <> %from ->\ntokenholder.holder <> %to ->\nbefore.ledger[tokenholder.holder] = some(tokenholder)\n")),(0,o.kt)("p",null,"Tokenholders other than ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"%to"),", are not modified nor added to ledger."),(0,o.kt)("h4",{id:"removed-ledger-records"},"Removed ",(0,o.kt)("inlineCode",{parentName:"h4"},"ledger")," records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"removed.ledger.isempty()\n")),(0,o.kt)("p",null,"No record is removed from ledger."),(0,o.kt)("h4",{id:"added-ledger-records"},"Added ",(0,o.kt)("inlineCode",{parentName:"h4"},"ledger")," records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"let some before_to = before.ledger[%to] in\n  added.ledger.isempty()\notherwise\n  added.ledger = [ { holder = %to; tokens = value } ]\n")),(0,o.kt)("p",null,"The added record in 'ledger', if any, is the %to record."),(0,o.kt)("h3",{id:"effect-on-allowance"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"allowance")),(0,o.kt)("h4",{id:"effect-on-fromcaller-allowance-record"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h4"},"(%from,caller)")," allowance record"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"caller <> %from ->\nlet some before_from_caller = before.allowance[(%from,caller)] in\nlet some after_from_caller = allowance[(%from,caller)] in\n  before_from_caller.amount > value ->\n  after_from_caller = { before_from_caller with\n    amount = abs (before_from_caller.amount - value)\n  }\notherwise false\notherwise true\n")),(0,o.kt)("p",null,"When caller is different from ",(0,o.kt)("inlineCode",{parentName:"p"},"%from"),", the amount caller is authorised to spend on the behalf of ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," is decreased by value if value is striclty greated than the authorized amount."),(0,o.kt)("h4",{id:"no-effect-on-allowance"},"No effect on allowance"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"caller = %from -> allowance = before.allowance\n")),(0,o.kt)("p",null,"No effect on allowance when caller is equal to ",(0,o.kt)("inlineCode",{parentName:"p"},"%from"),"."),(0,o.kt)("h4",{id:"unchanged-allowance-records"},"Unchanged allowance records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"forall a in allowance,\na.addr_owner <> %from and a.addr_spender <> caller ->\nbefore.allowance[(a.addr_owner,a.addr_spender)] = some(a)\n")),(0,o.kt)("p",null,"Allowed amounts other than those associated to ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," and caller are identical."),(0,o.kt)("h4",{id:"added-and-removed-allowance-records"},"Added and removed allowance records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"removed.allowance.isempty() and added.allowance.isempty()\n")),(0,o.kt)("p",null,"No allowance record is added or removed."),(0,o.kt)("h3",{id:"explicit-fail"},"Explicit fail"),(0,o.kt)("h4",{id:"not-enough-balance"},"Not Enough Balance"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},'fails with (msg : string) :\n  let some after_ledger_from = ledger[%from] in\n    msg = "NotEnoughBalance" and\n    after_ledger_from.tokens < value\n  otherwise true\n')),(0,o.kt)("p",null,'When the entry fails with message "NotEnoughBalance", value is stricly greater than the number of tokens of ',(0,o.kt)("inlineCode",{parentName:"p"},"%to"),". Cannot spend more than you own."),(0,o.kt)("h4",{id:"not-enough-allowance"},"Not Enough Allowance"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},'fails with (msg : string * (nat * nat)) :\n  let some after_allowance_from_caller = allowance[(%from,caller)] in\n    msg = ("NotEnoughAllowance", (value, after_allowance_from_caller.amount)) and\n    caller <> %from and\n    after_allowance_from_caller.amount < value\n  otherwise false\n')),(0,o.kt)("p",null,'When the entry fails with message "NotEnoughAllowance", caller is different from ',(0,o.kt)("inlineCode",{parentName:"p"},"%from")," and value is stricly greater than the allowed amount for ",(0,o.kt)("inlineCode",{parentName:"p"},"%from")," and caller. A spender cannot spend more than allowed."),(0,o.kt)("h3",{id:"effect-on-operations"},"Effect on operations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"length (operations) = 0\n")),(0,o.kt)("p",null,"No operation generated."),(0,o.kt)("h2",{id:"approve"},"Approve"),(0,o.kt)("h3",{id:"effect-on-ledger-1"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"ledger")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger = before.ledger\n")),(0,o.kt)("p",null,"No effect on ledger."),(0,o.kt)("h3",{id:"effect-on-allowance-1"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"allowance")),(0,o.kt)("h4",{id:"effect-on-callerspender-allowance-record"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h4"},"(caller,spender)")," allowance record"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"let some after_allowance_caller_spender = allowance[(caller,spender)] in\nlet some before_allowance_caller_spender = before.allowance[(caller,spender)] in\n  after_allowance_caller_spender = { before_allowance_caller_spender with\n    amount = value\n  }\notherwise\n  after_allowance_caller_spender = {\n    addr_owner = caller;\n    addr_spender = spender;\n    amount = value\n  }\notherwise false\n")),(0,o.kt)("p",null,"Allowed amount of tokens spendable by spender on the behalf of caller is set to value."),(0,o.kt)("h4",{id:"unchanged-allowance-records-1"},"Unchanged allowance records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"forall a in allowance,\n(a.addr_owner, a.addr_spender) <> (caller, spender) ->\nbefore.allowance[(a.addr_owner, a.addr_spender)] = some(a)\n")),(0,o.kt)("p",null,"Other allowed amounts than the allowed amount of tokens spendable by spender on the behalf of caller, are unchanged."),(0,o.kt)("h4",{id:"added-allowance-records"},"Added allowance records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"let some allowance_caller_spender = before.allowance[(caller, spender)] in\n  added.allowance.isempty()\notherwise\n  added.allowance = [ { addr_owner = caller; addr_spender = spender; amount = value } ]\nThe added allowance record, if any, is the caller and spender one.\n")),(0,o.kt)("h4",{id:"removed-allowance-records"},"Removed allowance records"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"removed.allowance.isempty()\n")),(0,o.kt)("p",null,"No record is removed from allowance."),(0,o.kt)("h3",{id:"explicit-fail-1"},"Explicit fail"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},'fails with (msg : (string * nat)) :\nlet some allowance_caller_spender = allowance[(caller,spender)] in\n  msg = ("UnsafeAllowanceChange", allowance_caller_spender.amount) and\n  value > 0 and\n  allowance_caller_spender.amount > 0\notherwise false\n')),(0,o.kt)("p",null,'When the entry fails with message "UnsafeAllowanceChange", value is strictly greater than 0 and the allowed amount of tokens spendable by spender on the behalf of caller is not equal to zero.\nNote that in that case, it may be set back to 0 by having spender call the transfer entry to transfer a number of tokens equal to the remaining allowed amount, from the approver address (ie caller above) to the approver address (ie to itself).\nIndeed, according to properties 1.3 and 2.1 of the transfer entry, this has no effect on ledger and sets allowance record to 0.'),(0,o.kt)("h3",{id:"effect-on-operations-1"},"Effect on operations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"length (operations) = 0\n")),(0,o.kt)("p",null,"No operation generated."),(0,o.kt)("h2",{id:"get-allowance"},"Get allowance"),(0,o.kt)("h3",{id:"effect-on-ledger-2"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"ledger")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger = before.ledger\n")),(0,o.kt)("p",null,"No effect on ledger."),(0,o.kt)("h3",{id:"effect-on-allowance-2"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"allowance")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"allowance = before.allowance\n")),(0,o.kt)("p",null,"No effect on allowance."),(0,o.kt)("h3",{id:"explicit-fail-2"},"Explicit fail"),(0,o.kt)("p",null,"No explicit fail. The entry implicitely fails though if the provided callback is invalid."),(0,o.kt)("h3",{id:"effect-on-operations-2"},"Effect on operations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"length (operations) = 1\n")),(0,o.kt)("p",null,"Creates one callback operation."),(0,o.kt)("h2",{id:"get-balance"},"Get balance"),(0,o.kt)("h3",{id:"effect-on-ledger-3"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"ledger")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger = before.ledger\n")),(0,o.kt)("p",null,"No effect on ledger."),(0,o.kt)("h3",{id:"effect-on-allowance-3"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"allowance")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"allowance = before.allowance\n")),(0,o.kt)("p",null,"No effect on allowance."),(0,o.kt)("h3",{id:"explicit-fail-3"},"Explicit fail"),(0,o.kt)("p",null,"No explicit fail. The entry implicitely fails though if the provided callback is invalid."),(0,o.kt)("h3",{id:"effect-on-operations-3"},"Effect on operations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"length (operations) = 1\n")),(0,o.kt)("p",null,"Creates one callback operation."),(0,o.kt)("h2",{id:"get-total-supply"},"Get total supply"),(0,o.kt)("h3",{id:"effect-on-ledger-4"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"ledger")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"ledger = before.ledger\n")),(0,o.kt)("p",null,"No effect on ledger."),(0,o.kt)("h3",{id:"effect-on-allowance-4"},"Effect on ",(0,o.kt)("inlineCode",{parentName:"h3"},"allowance")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"allowance = before.allowance\n")),(0,o.kt)("p",null,"No effect on allowance."),(0,o.kt)("h3",{id:"explicit-fail-4"},"Explicit fail"),(0,o.kt)("p",null,"No explicit fail. The entry implicitely fails though if the provided callback is invalid."),(0,o.kt)("h3",{id:"effect-on-operations-4"},"Effect on operations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype"},"length (operations) = 1\n")),(0,o.kt)("p",null,"Creates one callback operation."))}s.isMDXComponent=!0}}]);