"use strict";(self.webpackChunkcompletium_landing=self.webpackChunkcompletium_landing||[]).push([[1335],{8215:function(e,n,t){var a=t(7294);n.Z=function(e){var n=e.children,t=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},6396:function(e,n,t){t.d(n,{Z:function(){return m}});var a=t(7462),r=t(7294),o=t(2389),i=t(9443);var l=function(){var e=(0,r.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},d=t(1968),s=t(6010),p="tabItem_1uMI";function u(e){var n,t,a,o=e.lazy,i=e.block,u=e.defaultValue,m=e.values,c=e.groupId,k=e.className,N=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=m?m:N.map((function(e){var n=e.props;return{value:n.value,label:n.label}})),h=(0,d.lx)(f,(function(e,n){return e.value===n.value}));if(h.length>0)throw new Error('Docusaurus error: Duplicate values "'+h.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var P=null===u?u:null!=(n=null!=u?u:null==(t=N.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(a=N[0])?void 0:a.props.value;if(null!==P&&!f.some((function(e){return e.value===P})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+P+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var D=l(),g=D.tabGroupChoices,_=D.setTabGroupChoices,b=(0,r.useState)(P),R=b[0],v=b[1],I=[],A=(0,d.o5)().blockElementScrollPositionUntilNextRender;if(null!=c){var C=g[c];null!=C&&C!==R&&f.some((function(e){return e.value===C}))&&v(C)}var U=function(e){var n=e.currentTarget,t=I.indexOf(n),a=f[t].value;a!==R&&(A(n),v(a),null!=c&&_(c,a))},E=function(e){var n,t=null;switch(e.key){case"ArrowRight":var a=I.indexOf(e.currentTarget)+1;t=I[a]||I[0];break;case"ArrowLeft":var r=I.indexOf(e.currentTarget)-1;t=I[r]||I[I.length-1]}null==(n=t)||n.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":i},k)},f.map((function(e){var n=e.value,t=e.label;return r.createElement("li",{role:"tab",tabIndex:R===n?0:-1,"aria-selected":R===n,className:(0,s.Z)("tabs__item",p,{"tabs__item--active":R===n}),key:n,ref:function(e){return I.push(e)},onKeyDown:E,onFocus:U,onClick:U},null!=t?t:n)}))),o?(0,r.cloneElement)(N.filter((function(e){return e.props.value===R}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},N.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==R})}))))}function m(e){var n=(0,o.Z)();return r.createElement(u,(0,a.Z)({key:String(n)},e))}},754:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return u},metadata:function(){return m},toc:function(){return c},default:function(){return N}});var a=t(7462),r=t(3366),o=(t(7294),t(3905)),i=t(9960),l=t(6396),d=t(8215),s=["components"],p={id:"template3",title:"FA 2",sidebar_label:"FA 2",slug:"/templates/nft"},u=void 0,m={unversionedId:"templates/template3",id:"templates/template3",title:"FA 2",description:"Introduction",source:"@site/docs/templates/template3.md",sourceDirName:"templates",slug:"/templates/nft",permalink:"/docs/templates/nft",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/templates/template3.md",tags:[],version:"current",frontMatter:{id:"template3",title:"FA 2",sidebar_label:"FA 2",slug:"/templates/nft"},sidebar:"templates",previous:{title:"ERC20",permalink:"/docs/templates/erc20"},next:{title:"Zero-Coupon bond",permalink:"/docs/templates/zcb"}},c=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"API",id:"api",children:[{value:"Storage",id:"storage",children:[],level:3},{value:"Entrypoints",id:"entrypoints",children:[],level:3}],level:2},{value:"Originate",id:"originate",children:[],level:2},{value:"Code",id:"code",children:[],level:2}],k={toc:c};function N(e){var n=e.components,t=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"This contract follows the Financial Asset 2 (FA 2) ",(0,o.kt)("a",{href:"https://gitlab.com/tzip/tzip/-/blob/master/proposals/tzip-12/tzip-12.md"},"TZIP 12")," specification for non-fungible token on Tezos."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The version presented below is a simple minimal version. A full-featured version (with mint, burn, feeless transfer, royalties, ...) is available ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/rarible/tezos-protocol-contracts/tree/main/tokens"},"here"),"."))),(0,o.kt)("h2",{id:"api"},"API"),(0,o.kt)("p",null,"FA 2 introduces the concept of ",(0,o.kt)("em",{parentName:"p"},"operator"),", which is an account that can transfer a token on behalf of the owner. The delegation is done by the owner with the ",(0,o.kt)("inlineCode",{parentName:"p"},"update_operators")," entrypoint."),(0,o.kt)("h3",{id:"storage"},"Storage"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"token")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"collection")),(0,o.kt)("td",{parentName:"tr",align:null},"Token data, like price.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"ledger")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"collection")),(0,o.kt)("td",{parentName:"tr",align:null},"Association between token id and its owner.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"operator")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"collection")),(0,o.kt)("td",{parentName:"tr",align:null},"Delegation data: which operator can transfer which token owned by which owner?")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"token_metadata")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"collection")),(0,o.kt)("td",{parentName:"tr",align:null},"Token metadata.")))),(0,o.kt)("h3",{id:"entrypoints"},"Entrypoints"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"update_operators")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"upl")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"upl")," is a list of delegation data (named ",(0,o.kt)("inlineCode",{parentName:"td"},"operator_param")," with token, owner and operator), either to add or remove an operator to a token and owner. It fails if the ",(0,o.kt)("em",{parentName:"td"},"caller")," is not the declared owner in ",(0,o.kt)("inlineCode",{parentName:"td"},"upl"),".")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"transfer")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"txs")),(0,o.kt)("td",{parentName:"tr",align:null},"Transfers token ownerships specified in ",(0,o.kt)("inlineCode",{parentName:"td"},"txs"),", a list of ",(0,o.kt)("inlineCode",{parentName:"td"},"transfer_param")," (from, to, token). If ",(0,o.kt)("em",{parentName:"td"},"caller")," is not the token owner, it must be declared in ",(0,o.kt)("inlineCode",{parentName:"td"},"operator")," to be able to transfer, otherwise it fails.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"balance_of")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"requests")),(0,o.kt)("td",{parentName:"tr",align:null},"Returns the list a token balance for each token id in ",(0,o.kt)("inlineCode",{parentName:"td"},"requests"),".")))),(0,o.kt)("h2",{id:"originate"},"Originate"),(0,o.kt)("p",null,"Deploy the contract from ",(0,o.kt)("a",{href:"https://archetype-lang.org/"},"Archetype")," code below with the following ",(0,o.kt)(i.Z,{to:"/docs/cli",mdxType:"Link"},"Completium CLI")," example command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"completium-cli deploy nft.arl\n")),(0,o.kt)("h2",{id:"code"},"Code"),(0,o.kt)(l.Z,{defaultValue:"archetype",values:[{label:"Archetype",value:"archetype"},{label:"Michelson",value:"michelson"}],mdxType:"Tabs"},(0,o.kt)(d.Z,{value:"archetype",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-archetype",metastring:"nft",nft:!0},'\nasset ledger identified by ltoken to big_map {\n  ltoken     : nat;\n  lowner     : address;\n}\n\nasset operator identified by oaddr otoken oowner {\n  oaddr       : address;\n  otoken      : nat;\n  oowner      : address;\n}\n\nasset token_metadata to big_map {\n  key_token_id   : nat;\n  token_id       : nat;\n  symbol         : string;\n  name           : string;\n  decimals       : nat;\n  extras         : map<string, string>;\n}\n\nrecord operator_param {\n  opp_owner    : address;\n  opp_operator : address;\n  opp_token_id : nat\n} as ((owner, (operator, token_id)))\n\nentry update_operators (upl : list<or<operator_param, operator_param>>) {\n  for up in upl do\n    match up with\n    | left(param)  -> (* add *)\n      dorequire(ledger[param.opp_token_id].lowner = caller, "CALLER NOT OWNER");\n      operator.add({param.opp_operator; param.opp_token_id; param.opp_owner})\n    | right(param) -> (* remove *)\n      dorequire(ledger[param.opp_token_id].lowner = caller, "CALLER NOT OWNER");\n      operator.remove((param.opp_operator, param.opp_token_id, param.opp_owner))\n    end;\n  done;\n}\n\nrecord transfer_destination {\n  to_dest           : address;\n  token_id_dest     : nat;\n  token_amount_dest : nat\n} as ((to_, (token_id, amount)))\n\nrecord transfer_item {\n  from_: address;\n  txs: list<transfer_destination>;\n}\n\nentry %transfer (itxs : list<transfer_item>) {\n  for tx in itxs do\n    for td in tx.txs do begin\n      if caller <> tx.from_ then begin\n        (* check operator *)\n        dorequire(operator.contains((caller,td.token_id_dest,tx.from_)),"FA2_NOT_OPERATOR");\n      end;\n      (* set token ownership *)\n      ledger.addupdate(td.token_id_dest,{ lowner = td.to_dest });\n    end done;\n  done\n}\n\nrecord balance_of_request {\n  bo_owner : address;\n  btoken_id : nat;\n} as ((owner, token_id))\n\nrecord balance_of_response {\n  request : balance_of_request;\n  balance_ : nat;\n} as ((request, balance))\n\ngetter balance_of (requests : list<balance_of_request>) : list<balance_of_response> {\n  return map(requests, br -> {\n    request = br;\n    balance_ = (if ledger[br.btoken_id].lowner = br.bo_owner\n                then 1\n                else 0)\n  })\n}\n\nentry token_metadata_registry (c : contract<address>) {\n  transfer 0tz to entry c(selfaddress);\n}\n'))),(0,o.kt)(d.Z,{value:"michelson",mdxType:"TabItem"},(0,o.kt)("p",null,"The ",(0,o.kt)(i.Z,{to:"/docs/contract/programming-language#micheslon",mdxType:"Link"},"Michelson")," code is generated with version 1.2.3 of Archetype."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'# (Pair { } (Pair { } { }))\n{\n  storage (pair (big_map %ledger nat address) (pair (set %operator (pair address (pair nat address))) (big_map %token_metadata nat (pair (nat %token_id) (pair (string %symbol) (pair (string %name) (pair (nat %decimals) (map %extras string string))))))));\n  parameter (or (or (pair %balance_of (list %requests (pair (address %owner) (nat %token_id))) (contract (list (pair (pair %request (address %owner) (nat %token_id)) (nat %balance))))) (list %update_operators (or (pair %add_operator (address %owner) (pair (address %operator) (nat %token_id))) (pair %remove_operator (address %owner) (pair (address %operator) (nat %token_id)))))) (or (list %transfer (pair (address %from_) (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) (contract %token_metadata_registry address)));\n  code { NIL operation;\n         DIG 1;\n         UNPAIR;\n         DIP { UNPAIR 3 };\n         IF_LEFT\n           { IF_LEFT\n               { UNPAIR;\n                 DUP 6;\n                 DUP 3;\n                 AMOUNT;\n                 DUP 4;\n                 MAP { DUP;\n                       CAR;\n                       DUP 8;\n                       DUP 3;\n                       CDR;\n                       GET;\n                       IF_NONE\n                         { PUSH string "ledger";\n                           PUSH string "AssetNotFound";\n                           PAIR;\n                           FAILWITH }\n                         {  };\n                       COMPARE;\n                       EQ;\n                       IF\n                         { PUSH nat 1 }\n                         { PUSH nat 0 };\n                       DUP 2;\n                       PAIR;\n                       SWAP;\n                       DROP };\n                 TRANSFER_TOKENS;\n                 CONS;\n                 DIP { DIG 5; DROP };\n                 DUG 5;\n                 DROP 2;\n                 PAIR 3;\n                 DIG 1;\n                 PAIR }\n               { DUP;\n                 ITER { DUP;\n                        IF_LEFT\n                          { SENDER;\n                            DUP 5;\n                            DUP 3;\n                            CDR;\n                            CDR;\n                            GET;\n                            IF_NONE\n                              { PUSH string "ledger";\n                                PUSH string "AssetNotFound";\n                                PAIR;\n                                FAILWITH }\n                              {  };\n                            COMPARE;\n                            EQ;\n                            NOT;\n                            IF\n                              { PUSH string "CALLER NOT OWNER";\n                                FAILWITH }\n                              {  };\n                            DUP 5;\n                            DUP 2;\n                            CAR;\n                            DUP 3;\n                            CDR;\n                            CDR;\n                            PAIR;\n                            DUP 3;\n                            CDR;\n                            CAR;\n                            PAIR;\n                            MEM;\n                            IF\n                              { PUSH string "operator";\n                                PUSH string "KeyExists";\n                                PAIR;\n                                FAILWITH }\n                              { DUP 5;\n                                PUSH bool True;\n                                DUP 3;\n                                CAR;\n                                DUP 4;\n                                CDR;\n                                CDR;\n                                PAIR;\n                                DUP 4;\n                                CDR;\n                                CAR;\n                                PAIR;\n                                UPDATE;\n                                DIP { DIG 4; DROP };\n                                DUG 4 };\n                            DROP }\n                          { SENDER;\n                            DUP 5;\n                            DUP 3;\n                            CDR;\n                            CDR;\n                            GET;\n                            IF_NONE\n                              { PUSH string "ledger";\n                                PUSH string "AssetNotFound";\n                                PAIR;\n                                FAILWITH }\n                              {  };\n                            COMPARE;\n                            EQ;\n                            NOT;\n                            IF\n                              { PUSH string "CALLER NOT OWNER";\n                                FAILWITH }\n                              {  };\n                            DUP 5;\n                            PUSH bool False;\n                            DUP 3;\n                            CAR;\n                            DUP 4;\n                            CDR;\n                            CDR;\n                            PAIR;\n                            DUP 4;\n                            CDR;\n                            CAR;\n                            PAIR;\n                            UPDATE;\n                            DIP { DIG 4; DROP };\n                            DUG 4;\n                            DROP };\n                        DROP };\n                 DROP;\n                 PAIR 3;\n                 DIG 1;\n                 PAIR } }\n           { IF_LEFT\n               { DUP;\n                 ITER { DUP;\n                        CDR;\n                        ITER { DUP 2;\n                               CAR;\n                               SENDER;\n                               COMPARE;\n                               NEQ;\n                               IF\n                                 { DUP 5;\n                                   DUP 3;\n                                   CAR;\n                                   DUP 3;\n                                   CDR;\n                                   CAR;\n                                   PAIR;\n                                   SENDER;\n                                   PAIR;\n                                   MEM;\n                                   NOT;\n                                   IF\n                                     { PUSH string "FA2_NOT_OPERATOR";\n                                       FAILWITH }\n                                     {  } }\n                                 {  };\n                               DUP 4;\n                               DUP 2;\n                               CDR;\n                               CAR;\n                               MEM;\n                               IF\n                                 { DUP 4;\n                                   DUP 2;\n                                   CAR;\n                                   SOME;\n                                   DUP 3;\n                                   CDR;\n                                   CAR;\n                                   UPDATE;\n                                   DIP { DIG 3; DROP };\n                                   DUG 3 }\n                                 { DUP 4;\n                                   DUP 2;\n                                   CDR;\n                                   CAR;\n                                   MEM;\n                                   IF\n                                     { PUSH string "ledger";\n                                       PUSH string "KeyExists";\n                                       PAIR;\n                                       FAILWITH }\n                                     { DUP 4;\n                                       DUP 2;\n                                       CAR;\n                                       SOME;\n                                       DUP 3;\n                                       CDR;\n                                       CAR;\n                                       UPDATE;\n                                       DIP { DIG 3; DROP };\n                                       DUG 3 } };\n                               DROP };\n                        DROP };\n                 DROP;\n                 PAIR 3;\n                 DIG 1;\n                 PAIR }\n               { DUP 5;\n                 DUP 2;\n                 PUSH mutez 0;\n                 SELF_ADDRESS;\n                 TRANSFER_TOKENS;\n                 CONS;\n                 DIP { DIG 4; DROP };\n                 DUG 4;\n                 DROP;\n                 PAIR 3;\n                 DIG 1;\n                 PAIR } } };\n}\n')))))}N.isMDXComponent=!0}}]);