(self.webpackChunkcompletium_landing=self.webpackChunkcompletium_landing||[]).push([[7703],{9380:function(t,n,e){"use strict";e.r(n),e.d(n,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return m},toc:function(){return d},default:function(){return h}});var a=e(2122),o=e(9756),r=(e(7294),e(3905)),i=e(7134),s=e(6742),c=["components"],l={id:"first6",title:"Claim ownership",sidebar_label:"6. Claim ownership",slug:"/dapp-first/claim"},p=void 0,m={unversionedId:"dapp-first/first6",id:"dapp-first/first6",isDocsHomePage:!1,title:"Claim ownership",description:"The goal is to add a Claim button and claim the ownership.",source:"@site/docs/dapp-first/first6.md",sourceDirName:"dapp-first",slug:"/dapp-first/claim",permalink:"/docs/dapp-first/claim",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/dapp-first/first6.md",version:"current",frontMatter:{id:"first6",title:"Claim ownership",sidebar_label:"6. Claim ownership",slug:"/dapp-first/claim"},sidebar:"first",previous:{title:"5. Make a bid",permalink:"/docs/dapp-first/make-bid"},next:{title:"7. To go further",permalink:"/docs/dapp-first/further"}},d=[{value:"Claim button",id:"claim-button",children:[]},{value:"Claim",id:"claim",children:[]},{value:"<code>App.js</code> code",id:"appjs-code",children:[]}],u={toc:d};function h(t){var n=t.components,e=(0,o.Z)(t,c);return(0,r.kt)("wrapper",(0,a.Z)({},u,e,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The goal is to add a ",(0,r.kt)("em",{parentName:"p"},"Claim")," button and claim the ownership."),(0,r.kt)("h2",{id:"claim-button"},"Claim button"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Replace")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/src/App.js")," the comment below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/* FIXME: Step 6.1 */\n")),(0,r.kt)("p",null,"with the code below (click 'copy' in the upper-right-hand corner):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{9}","{9}":!0},'const ClaimButton = () => {\n  const { settings } = useSettingsContext();\n  const tezos = useTezos();\n  const account = useAccountPkh();\n  const { setInfoSnack, setErrorSnack, hideSnack } = useSnackContext();\n  const claim = async () => {\n    try {\n      const contract  = await tezos.wallet.at(settings.contract);\n      const operation = await contract.methods.claim(UnitValue).send();\n      const shorthash = operation.opHash.substring(0, 10) + "...";\n      setInfoSnack(`waiting for ${ shorthash } to be confirmed ...`);\n      await operation.receipt();\n      hideSnack();\n    } catch (error) {\n      setErrorSnack(error.message);\n      setTimeout(hideSnack, 4000);\n    }\n  }\n  return (\n    <Button onClick={ claim } variant="outlined" disabled={ account === null }>\n      Claim\n    </Button>);\n}\n')),(0,r.kt)("p",null,"The implementation is very similar to the one of the ",(0,r.kt)(s.Z,{to:"/docs/dapp-first/bid-button#buttons-code",mdxType:"Link"},"Bid")," button. The differences are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"it does not require any transfer of tezies, hence the ",(0,r.kt)("inlineCode",{parentName:"li"},"send")," method does not have any argument"),(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)(s.Z,{to:"/docs/dapp-first/contract#entrypoints",mdxType:"Link"},"contract"),"'s ",(0,r.kt)("inlineCode",{parentName:"li"},"claim")," method is called")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Replace")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/src/App.js")," the comment below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{ /* FIXME: Step 6.2 */ }\n")),(0,r.kt)("p",null,"with the code below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<Grid item xs={12}>\n  <ClaimButton />\n</Grid>\n")),(0,r.kt)("h2",{id:"claim"},"Claim"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Click")," the ",(0,r.kt)("em",{parentName:"p"},"Claim")," button and confirm the wallet popup. When operation is confirmed (snack message disappears), refresh the Better Call Dev ",(0,r.kt)(s.Z,{to:"/docs/dapp-first/make-bid#set-asset-up-for-sale",mdxType:"Link"},"contract page")," and check the effect on the contract (click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"claim")," operation):"),(0,r.kt)(i.Z,{img:"ownership_bcd3.png",width:"100%",mdxType:"DappFigure"}),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Owner")," has been set to the account in your walletn, which means you are now the owner of the asset!"),(0,r.kt)("li",{parentName:"ul"},"Contract state is back to ",(0,r.kt)("inlineCode",{parentName:"li"},"0"),' which is "Not For Sale".')),(0,r.kt)("p",null,"The internal transaction (at the bottom in the screenshot above) is the transfer of the contract balance (10 tezies) to the previous owner, as per the ",(0,r.kt)(s.Z,{to:"/docs/dapp-first/contract#entrypoints",mdxType:"Link"},"contract")," entrypoint ",(0,r.kt)("inlineCode",{parentName:"p"},"claim"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-archetype",metastring:"{5}","{5}":!0},"transition claim () {\n  ...\n  with effect {\n    ...\n    transfer balance to owner;\n    ...\n  }\n}\n")),(0,r.kt)("h2",{id:"appjs-code"},(0,r.kt)("inlineCode",{parentName:"h2"},"App.js")," code"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This section is for information only, no action is required."))),(0,r.kt)("p",null,"This section presents the code of ",(0,r.kt)("inlineCode",{parentName:"p"},"~/src/App.js")," at the end of this step:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{86-108,136-138}","{86-108,136-138}":!0},"import './App.css';\nimport React from 'react';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport Container from '@material-ui/core/Container';\nimport Typography from '@material-ui/core/Typography';\nimport Link from '@material-ui/core/Link';\nimport Grid from '@material-ui/core/Grid';\n\nimport { DAppProvider } from './dappstate';\nimport { SnackProvider } from './snackstate';\nimport { appName, alegreya } from './settings';\nimport Snack from './components/Snack';\nimport WalletButton from './components/WalletButton';\n\nimport { TezosToolkit } from '@taquito/taquito';\nimport { endpoint, contractAddress, courier } from './settings.js';\nimport { useState } from 'react';\n\nimport Button from '@material-ui/core/Button';\nimport { useTezos, useAccountPkh } from './dappstate';\nimport { useSnackContext } from './snackstate';\nimport { UnitValue } from '@taquito/taquito';\n\nconst Cell = (props) => {\n  return (<Grid item xs={6}><Typography align=\"left\" variant=\"subtitle2\"\n    style={ props.data ? { fontFamily: courier } : { } }> { props.val }\n  </Typography></Grid>)\n}\n\nconst OwnershipData = (props) => {\n  const { settings } = useSettingsContext();\n  const [{ assetid, owner, forsale }, setData] = useState(() => ({\n      assetid : \"\",\n      owner   : \"\",\n      forsale : \"\",\n    }));\n  const loadStorage = React.useCallback(async () => {\n    const tezos     = new TezosToolkit(settings.endpoint);\n    const contract  = await tezos.contract.at(settings.contract);\n    const storage   = await contract.storage();\n    console.log(storage);\n    setData({\n      assetid : storage.assetid,\n      owner   : storage.owner,\n      forsale : storage._state.toNumber() > 0 ? \"For Sale\" : \"Not For Sale\",\n    });\n  }, [assetid, owner, forsale]);\n  if (assetid === \"\") loadStorage();\n  return (\n    <Container maxWidth='xs'>\n    <Grid container direction=\"row\" alignItems=\"center\" spacing={1}>\n      <Cell val=\"Asset Id\"/><Cell val={ assetid.substring(0, 20) + \"...\" } data/>\n      <Cell val=\"Owner\"   /><Cell val={ owner.substring(0, 20) + \"...\" } data/>\n      <Cell val=\"Status\"  /><Cell val={ forsale }/>\n    </Grid>\n    </Container>\n  );\n}\n\nconst BidButton = () => {\n  const tezos = useTezos();\n  const account = useAccountPkh();\n  const { settings } = useSettingsContext();\n  const { setInfoSnack, setErrorSnack, hideSnack } = useSnackContext();\n  const bid = async () => {\n    try {\n      const contract  = await tezos.wallet.at(contract);\n      const operation = await contract.methods.bid(UnitValue).send({ amount: 10 });\n      const shorthash = operation.opHash.substring(0, 10) + \"...\";\n      setInfoSnack(`waiting for ${ shorthash } to be confirmed ...`);\n      await operation.receipt();\n      hideSnack();\n    } catch (error) {\n      setErrorSnack(error.message);\n      setTimeout(hideSnack, 4000);\n    }\n  }\n  return (\n    <Button onClick={ bid } variant=\"outlined\" disabled={ account === null }>\n      post bid\n    </Button>);\n}\n\nconst ClaimButton = () => {\n  const { settings } = useSettingsContext();\n  const tezos = useTezos();\n  const account = useAccountPkh();\n  const { setInfoSnack, setErrorSnack, hideSnack } = useSnackContext();\n  const claim = async () => {\n    try {\n      const contract  = await tezos.wallet.at(settings.contract);\n      const operation = await contract.methods.claim(UnitValue).send();\n      const shorthash = operation.opHash.substring(0, 10) + \"...\";\n      setInfoSnack(`waiting for ${ shorthash } to be confirmed ...`);\n      await operation.receipt();\n      hideSnack();\n    } catch (error) {\n      setErrorSnack(error.message);\n      setTimeout(hideSnack, 4000);\n    }\n  }\n  return (\n    <Button onClick={ claim } variant=\"outlined\" disabled={ account === null }>\n      Claim\n    </Button>);\n}\n\nfunction App() {\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n  const theme = React.useMemo(\n    () =>\n      createMuiTheme({\n        palette: {\n          type: prefersDarkMode ? 'dark' : 'light',\n        },\n      }),\n    [prefersDarkMode],\n  );\n  return (\n    <DAppProvider appName={ appName }>\n      <SettingsProvider>\n      <SnackProvider>\n      <ThemeProvider theme={ theme }>\n      <CssBaseline />\n      <div className=\"App\">\n        <Container style={{ marginTop: 50 }}>\n          <Grid container spacing={3}>\n            <Grid item xs={12}>\n                <OwnershipData />\n            </Grid>\n            <Grid item xs={12}>\n                <BidButton />\n            </Grid>\n            <Grid item xs={12}>\n                <ClaimButton />\n            </Grid>\n            <Grid item xs={12}>\n                <WalletButton />\n            </Grid>\n          </Grid>\n        </Container>\n      </div>\n      <SettingsPanel/>\n      <Snack />\n      </ThemeProvider>\n      </SnackProvider>\n      </SettingsProvider>\n    </DAppProvider>\n  );\n}\n\nexport default App;\n")))}h.isMDXComponent=!0}}]);