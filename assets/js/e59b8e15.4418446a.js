"use strict";(self.webpackChunkcompletium_landing=self.webpackChunkcompletium_landing||[]).push([[5263],{3079:function(t,e,n){var a=n(7294),i=n(282),r=n(8500),l=n(3457),o=n(9960),p=n(4996);e.Z=function(t){var e=a.useMemo((function(){return(0,r.Z)({palette:{type:"dark"}})}),[!0]);return a.createElement("div",{style:{textAlign:"center",paddingTop:"0px",paddingBottom:"40px"}},a.createElement(l.Z,{theme:e},t.internal?a.createElement(i.Z,{variant:"outlined",size:"large",component:o.Z,to:(0,p.Z)("docs/"+t.url+"/")},t.txt):a.createElement(i.Z,{variant:"outlined",size:"large",onClick:function(){return window.open(t.url,"_blank")}},t.txt)))}},7083:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return d},contentTitle:function(){return c},metadata:function(){return m},toc:function(){return u},default:function(){return h}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),l=n(9960),o=n(7134),p=n(3079),s=["components"],d={id:"miles7",title:"Contract setup",sidebar_label:"Contract setup",slug:"/dapp-miles/miles-tg-contract"},c=void 0,m={unversionedId:"dapp-miles/miles7",id:"dapp-miles/miles7",title:"Contract setup",description:"The smart contract is at this location:",source:"@site/docs/dapp-miles/miles7.md",sourceDirName:"dapp-miles",slug:"/dapp-miles/miles-tg-contract",permalink:"/docs/dapp-miles/miles-tg-contract",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/dapp-miles/miles7.md",tags:[],version:"current",frontMatter:{id:"miles7",title:"Contract setup",sidebar_label:"Contract setup",slug:"/dapp-miles/miles-tg-contract"},sidebar:"dapps",previous:{title:"Presentation",permalink:"/docs/dapp-miles/miles-tg-overview"},next:{title:"Interactions",permalink:"/docs/dapp-miles/miles-tg-interactions"}},u=[{value:"Origination",id:"origination",children:[],level:2},{value:"Add miles",id:"add-miles",children:[],level:2},{value:"Skip this step?",id:"skip-this-step",children:[],level:2}],k={toc:u};function h(t){var e=t.components,n=(0,i.Z)(t,s);return(0,r.kt)("wrapper",(0,a.Z)({},k,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The smart contract is at this location:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"~/completium-dapp-miles/contract/miles_with_expiration.arl")),(0,r.kt)("p",null,"The contract is written in ",(0,r.kt)("a",{href:"https://archetype-lang.org/"},"Archetype")," language. Go to the Smart contract section for a detailed presentation."),(0,r.kt)("p",null,"The setup consists in deploying the contract and adding mile to the user account."),(0,r.kt)("h2",{id:"origination"},"Origination"),(0,r.kt)("p",null,"Open the ",(0,r.kt)(l.Z,{to:"/docs/dapp-tools/gitpod#open-terminal",mdxType:"Link"},"terminal")," and enter the following command line to originate (deploy) the smart contract is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'completium-cli deploy ./contract/miles_with_expiration.arl --named miles --parameters \'{ "admin" : "tz1h4CiqWxNe4UxSpkwXy617RM6DaK6NU76P" }\'\n')),(0,r.kt)("p",null,"The ",(0,r.kt)(l.Z,{to:"/docs/cli/contract#deploy--originate",mdxType:"Link"},"originate command")," triggers two operations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the contract compilation to Michelson with archetype compiler"),(0,r.kt)("li",{parentName:"ul"},"the Michelson contract origination with Tezos client")),(0,r.kt)("p",null,"The contract may then be referred to as ",(0,r.kt)("inlineCode",{parentName:"p"},"miles")," in future interactions."),(0,r.kt)("p",null,"If you are using the preset ",(0,r.kt)(l.Z,{to:"/docs/dapp-tools/gitpod",mdxType:"Link"},"Gitpod")," environement, note that ",(0,r.kt)(l.Z,{to:"/docs/cli",mdxType:"Link"},"completium-cli")," is pre-installed with the ",(0,r.kt)(l.Z,{to:"/docs/dapp-tools/faucet#admin-account",mdxType:"Link"},"admin")," account. See this section for more information."),(0,r.kt)("p",null,"The address of the newly originated contract is visible in the command output, as illustrated below:"),(0,r.kt)(o.Z,{img:"miles-newcontract.png",mdxType:"DappFigure"}),(0,r.kt)("p",null,"You may got to ",(0,r.kt)(l.Z,{to:"/docs/dapp-tools/bcd",mdxType:"Link"},"Better call dev")," contract explorer to check it:"),(0,r.kt)(p.Z,{url:"https://better-call.dev/",txt:"go to better call dev",mdxType:"DappButton"}),(0,r.kt)("p",null,"The new contract address needs to be set in the DApp's ",(0,r.kt)("inlineCode",{parentName:"p"},"src/settings.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/////////////////////////////////////////////////////////////////////////////\n// FIX ME\n// set new contract address\n/////////////////////////////////////////////////////////////////////////////\nexport const  contractAddress = "KT1XpM1f6cq8cy8m8WV9xSsE5nBix2DzTYmx"\n')),(0,r.kt)("h2",{id:"add-miles"},"Add miles"),(0,r.kt)("p",null,"In order to provide miles to a user, the amdin must call the 'add' entry point of the contract."),(0,r.kt)("p",null,"If you don't have a user account, follow these ",(0,r.kt)(l.Z,{to:"/docs/dapp-tools/faucet#create-test-account",mdxType:"Link"},"instructions")," to get one."),(0,r.kt)("p",null,"The entry point signature is presented below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-archetype"},"entry add (ow                 : address,\n           newmile_id         : string,\n           newmile_amount     : int,\n           newmile_expiration : date) {\n   called by admin\n   effect {\n     ...\n   }\n}\n")),(0,r.kt)("p",null,"Parameters are presented below:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Value"),(0,r.kt)("th",{parentName:"tr",align:"right"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ow"),(0,r.kt)("td",{parentName:"tr",align:"center"},"USER_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:"right"},"address of the miles' owner, for example '@tz1h4CiqWxNe4UxSpkwXy617RM6DaK6NU76P'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"newmile_id"),(0,r.kt)("td",{parentName:"tr",align:"center"},'USER_ADDRESS + "_0"'),(0,r.kt)("td",{parentName:"tr",align:"right"},"a unique identifier for the created miles, for example 'tz1h4CiqWxNe4UxSpkwXy617RM6DaK6NU76P_0'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"newmile_amount"),(0,r.kt)("td",{parentName:"tr",align:"center"},"20"),(0,r.kt)("td",{parentName:"tr",align:"right"},"number of miles to create")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"newmile_expiration"),(0,r.kt)("td",{parentName:"tr",align:"center"},"TOMORROW"),(0,r.kt)("td",{parentName:"tr",align:"right"},"date beyond which miles are expired, for example '2021-06-28'")))),(0,r.kt)("p",null,"where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"USER_ADDRESS is replaced by the DApp user account to receive the miles"),(0,r.kt)("li",{parentName:"ul"},"TOMORROW is replaced by a date in the future, for example tomorrow")),(0,r.kt)("p",null,"In the ",(0,r.kt)(l.Z,{to:"/docs/dapp-tools/gitpod#open-terminal",mdxType:"Link"},"terminal")," enter the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'completium-cli call miles --entry add --arg \'{ "ow":"tz1hyc1CRQpjskJUUaGrh85UZXPi6kU4JuGd", "newmile_id":"id1", "newmile_expiration":"2022-12-25"  }\'\n')),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"tz1hyc1CRQpjskJUUaGrh85UZXPi6kU4JuGd")," in the command above with your user account address."))),(0,r.kt)("h2",{id:"skip-this-step"},"Skip this step?"),(0,r.kt)("p",null,"It is possible to skip this phase and use the contract already deployed for the demo, and available at the following address:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"KT1XpM1f6cq8cy8m8WV9xSsE5nBix2DzTYmx\n")),(0,r.kt)(p.Z,{url:"https://better-call.dev/ithacanet/KT1XpM1f6cq8cy8m8WV9xSsE5nBix2DzTYmx/operations",txt:"open in better call dev",mdxType:"DappButton"}),(0,r.kt)("p",null,"Go to the ",(0,r.kt)(l.Z,{to:"/docs/dapp-miles/create-miles#miles-creation-transaction",mdxType:"Link"},"use case")," section to know how to add miles for your user account."))}h.isMDXComponent=!0}}]);