"use strict";(self.webpackChunkcompletium_landing=self.webpackChunkcompletium_landing||[]).push([[1674],{3079:function(n,e,t){var o=t(7294),a=t(282),r=t(8500),c=t(3457),i=t(9960),s=t(4996);e.Z=function(n){var e=o.useMemo((function(){return(0,r.Z)({palette:{type:"dark"}})}),[!0]);return o.createElement("div",{style:{textAlign:"center",paddingTop:"0px",paddingBottom:"40px"}},o.createElement(c.Z,{theme:e},n.internal?o.createElement(a.Z,{variant:"outlined",size:"large",component:i.Z,to:(0,s.Z)("docs/"+n.url+"/")},n.txt):o.createElement(a.Z,{variant:"outlined",size:"large",onClick:function(){return window.open(n.url,"_blank")}},n.txt)))}},807:function(n,e,t){t(7294),t(4996)},3910:function(n,e,t){t.r(e),t.d(e,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var o=t(7462),a=t(3366),r=(t(7294),t(3905)),c=(t(807),t(7134),t(3079),t(9960)),i=["components"],s={id:"escrow7",title:"Interactions",sidebar_label:"Interactions",slug:"/dapp-escrow/interactions"},l=void 0,p={unversionedId:"dapp-escrow/escrow7",id:"dapp-escrow/escrow7",title:"Interactions",description:"Contract origination",source:"@site/docs/dapp-escrow/escrow7.md",sourceDirName:"dapp-escrow",slug:"/dapp-escrow/interactions",permalink:"/docs/dapp-escrow/interactions",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/dapp-escrow/escrow7.md",tags:[],version:"current",frontMatter:{id:"escrow7",title:"Interactions",sidebar_label:"Interactions",slug:"/dapp-escrow/interactions"},sidebar:"dapps",previous:{title:"Contract Compilation",permalink:"/docs/dapp-escrow/compilation"},next:{title:"Introduction",permalink:"/docs/dapp-nonfungible"}},d=[{value:"Contract origination",id:"contract-origination",children:[],level:2},{value:"Fund transaction",id:"fund-transaction",children:[],level:2},{value:"Complete transaction",id:"complete-transaction",children:[],level:2}],u={toc:d};function m(n){var e=n.components,t=(0,a.Z)(n,i);return(0,r.kt)("wrapper",(0,o.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"contract-origination"},"Contract origination"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 49"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"HandleNext")," component ",(0,r.kt)(c.Z,{to:"/docs/dapp-tools/taquito#contract-origination",mdxType:"Link"},"originates")," the escrow contract with taquito."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"}," const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Origination 'contract'\n    ///////////////////////////////////////////////////////////////////////////\n  }\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"tezos.wallet.originate({\n  code: code,\n  storage: getStorage(\n    seller,                              // seller\n    account,                             // buyer\n    taxCollector,                        // taxcollector\n    (parseInt(price)*1000000).toString() // price\n  )}\n}).send().then(op => {\n  console.log(`Waiting for confirmation of origination...`);\n  props.openSnack();\n  return op.contract()\n}).then (contract => {\n  props.closeSnack();\n  setAddress(contract.address);\n  props.handleNext();\n  console.log(`Origination completed for ${contract.address}.`);\n}).catch(error => console.log(`Error: ${JSON.stringify(error, null, 2)}`));\n")),(0,r.kt)("p",null,"Note here that the constants ",(0,r.kt)("inlineCode",{parentName:"p"},"taxrate"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"securityrate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"deadline")," declared in contract's storage are actually not part of the storage since they are declared as ",(0,r.kt)("inlineCode",{parentName:"p"},"constant")," and inlined in the contract code. Hence they are not required as parameters of ",(0,r.kt)("inlineCode",{parentName:"p"},"getStorage"),"."),(0,r.kt)("h2",{id:"fund-transaction"},"Fund transaction"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 123"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Call 'fund' entry point\n    ///////////////////////////////////////////////////////////////////////////\n  }\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"tezos.wallet.at(escrowState.address).then(contract => {\n  contract.methods.fund(UnitValue).send({ amount: total.toString() }).then(op => {\n    props.openSnack();\n    op.receipt().then(() => {\n      props.closeSnack();\n      setBalance(total.toString());\n      props.handleNext();\n    })\n  })\n});\n")),(0,r.kt)("h2",{id:"complete-transaction"},"Complete transaction"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 123"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Call 'complete' entry points\n    ///////////////////////////////////////////////////////////////////////////\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"tezos.wallet.at(escrowState.address).then(contract => {\n  contract.methods.complete(UnitValue).send().then(op => {\n    props.openSnack();\n    op.receipt().then(() => {\n      props.closeSnack();\n      setBalance(0);\n      props.handleNext();\n    })\n  })\n});\n")))}m.isMDXComponent=!0}}]);