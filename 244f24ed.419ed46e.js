(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{234:function(e,t,a){"use strict";function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}},240:function(e,t,a){"use strict";var n=a(0),r=a(241);t.a=function(){const e=Object(n.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},241:function(e,t,a){"use strict";var n=a(0);const r=Object(n.createContext)(void 0);t.a=r},242:function(e,t,a){"use strict";var n=a(0),r=a.n(n),l=a(240),b=a(234),c=a(56),i=a.n(c);const d=37,o=39;t.a=function(e){const{lazy:t,block:a,defaultValue:c,values:s,groupId:p,className:u}=e,{tabGroupChoices:m,setTabGroupChoices:O}=Object(l.a)(),[j,N]=Object(n.useState)(c),h=n.Children.toArray(e.children);if(null!=p){const e=m[p];null!=e&&e!==j&&s.some((t=>t.value===e))&&N(e)}const y=e=>{N(e),null!=p&&O(p,e)},f=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(b.a)("tabs",{"tabs--block":a},u)},s.map((({value:e,label:t})=>r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":j===e,className:Object(b.a)("tabs__item",i.a.tabItem,{"tabs__item--active":j===e}),key:e,ref:e=>f.push(e),onKeyDown:e=>{((e,t,a)=>{switch(a.keyCode){case o:((e,t)=>{const a=e.indexOf(t)+1;e[a]?e[a].focus():e[0].focus()})(e,t);break;case d:((e,t)=>{const a=e.indexOf(t)-1;e[a]?e[a].focus():e[e.length-1].focus()})(e,t)}})(f,e.target,e)},onFocus:()=>y(e),onClick:()=>{y(e)}},t)))),t?Object(n.cloneElement)(h.filter((e=>e.props.value===j))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},h.map(((e,t)=>Object(n.cloneElement)(e,{key:t,hidden:e.props.value!==j})))))}},243:function(e,t,a){"use strict";var n=a(3),r=a(0),l=a.n(r);t.a=function({children:e,hidden:t,className:a}){return l.a.createElement("div",Object(n.a)({role:"tabpanel"},{hidden:t,className:a}),e)}},91:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return d})),a.d(t,"toc",(function(){return o})),a.d(t,"default",(function(){return p}));var n=a(3),r=a(7),l=(a(0),a(227)),b=(a(228),a(242)),c=a(243),i={id:"template11",title:"Escrow",sidebar_label:"Escrow",slug:"/templates/escrow"},d={unversionedId:"templates/template11",id:"templates/template11",isDocsHomePage:!1,title:"Escrow",description:"Introduction",source:"@site/docs/templates/template11.md",slug:"/templates/escrow",permalink:"/docs/templates/escrow",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/templates/template11.md",version:"current",sidebar_label:"Escrow",sidebar:"templates",previous:{title:"Autocallable note",permalink:"/docs/templates/acn"},next:{title:"Miles",permalink:"/docs/templates/miles"}},o=[{value:"Introduction",id:"introduction",children:[]},{value:"API",id:"api",children:[{value:"Storage",id:"storage",children:[]},{value:"Entrypoints",id:"entrypoints",children:[]}]},{value:"Code",id:"code",children:[]}],s={toc:o};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h2",{id:"introduction"},"Introduction"),Object(l.b)("p",null,"The escrow smart contract establishes a decentralized purchase process between the seller and buyer. The principle is that the price amount is escrowed in the smart contract and released when the purchased item is received by buyer."),Object(l.b)("p",null,"The critical point of the process is that it requires actions from the buyer and the seller to complete the process:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"if the seller does not send the item, buyer's fund are locked in the escrow"),Object(l.b)("li",{parentName:"ul"},"if the buyer does not complete the process, even if the item is received, then the seller does not reveive payment")),Object(l.b)("p",null,"In order to motivate both the seller and the buyer to execute the process, the basic idea is that they fund the escrow with ",Object(l.b)("em",{parentName:"p"},"security deposits")," that are transferred back only if the process is complete. In the escrow presented here, security deposits are a proportion of the price of the item."),Object(l.b)("h2",{id:"api"},"API"),Object(l.b)("h3",{id:"storage"},"Storage"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Name"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Type"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"seller")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"address")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Seller's address.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"buyer")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"address")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Buyer's address.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"taxcollecter")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"address")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Tax collector's address.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"price")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"tez")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Amount of transaction.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"taxrate")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"rational")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Tax rate applied to ",Object(l.b)("inlineCode",{parentName:"td"},"price"))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"securityrate")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"rational")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Security rate applied to ",Object(l.b)("inlineCode",{parentName:"td"},"price")," for security deposit.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"_state")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"states")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Escrow state, one of ",Object(l.b)("inlineCode",{parentName:"td"},"Create"),", ",Object(l.b)("inlineCode",{parentName:"td"},"Aborted"),", ",Object(l.b)("inlineCode",{parentName:"td"},"Funded"),", ",Object(l.b)("inlineCode",{parentName:"td"},"Completed"))))),Object(l.b)("h3",{id:"entrypoints"},"Entrypoints"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Name"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Parameters"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"abort")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"buyer")," and ",Object(l.b)("inlineCode",{parentName:"td"},"seller")," can abort escrow in ",Object(l.b)("inlineCode",{parentName:"td"},"Created")," state.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"toFunded")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Internally called by escrow to go to ",Object(l.b)("inlineCode",{parentName:"td"},"Funded")," state.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"fund")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Called by ",Object(l.b)("inlineCode",{parentName:"td"},"buyer")," and ",Object(l.b)("inlineCode",{parentName:"td"},"seller")," to provide funds:",Object(l.b)("ul",null,Object(l.b)("li",null,Object(l.b)("inlineCode",{parentName:"td"},"buyer")," must transfer price, security deposit and taxes "),Object(l.b)("li",null,Object(l.b)("inlineCode",{parentName:"td"},"seller")," must transfer security deposit.")))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(l.b)("inlineCode",{parentName:"td"},"complete")),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Called by ",Object(l.b)("inlineCode",{parentName:"td"},"buyer")," when purchased item is received. This transfers:",Object(l.b)("ul",null,Object(l.b)("li",null,"item price and security deposit to ",Object(l.b)("inlineCode",{parentName:"td"},"seller")),Object(l.b)("li",null,"security deposit to ",Object(l.b)("inlineCode",{parentName:"td"},"buyer")),Object(l.b)("li",null,"tax to ",Object(l.b)("inlineCode",{parentName:"td"},"taxcollector"))))))),Object(l.b)("h2",{id:"code"},"Code"),Object(l.b)(b.a,{defaultValue:"archetype",values:[{label:"Archetype",value:"archetype"},{label:"Michelson",value:"michelson"}],mdxType:"Tabs"},Object(l.b)(c.a,{value:"archetype",mdxType:"TabItem"},Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-archetype",metastring:'title="escrow.arl"',title:'"escrow.arl"'}),'archetype escrow(\nseller       : role,\nbuyer        : role,\ntaxcollector : role,\nprice        : tez,\ntaxrate      : rational,\nsecurityrate : rational,\n)\n\nvariable buyer_funded  : bool = false\nvariable seller_funded : bool = false\n\n(* states *)\nstates =\n | Created initial\n | Aborted\n | Funded\n | Completed\n\ntransition abort () {\n  called by buyer or seller\n  from Created to Aborted\n}\n\ntransition toFunded () {\n  called by selfaddress\n  from Created to Funded\n}\n\nentry fund () {\n  called by buyer or seller\n  effect {\n    if caller = buyer then begin\n      dorequire(transferred >= (1 + taxrate + securityrate) * price, "NOT_ENOUGH_FUND");\n      buyer_funded := true\n    end else if caller = seller then begin\n      dorequire(transferred >= securityrate * price, "NOT_ENOUGH_FUND");\n      seller_funded := true\n    end;\n    if buyer_funded and seller_funded then\n      transfer 0tz to entry self.toFunded()\n  }\n}\n\ntransition complete () {\n  called by buyer\n  from Funded to Completed\n  with effect {\n    transfer ((1 + securityrate) * price) to seller;\n    transfer (securityrate * price)       to buyer;\n    if taxrate > 0 then\n      transfer (taxrate * price)          to taxcollector;\n  }\n}\n'))),Object(l.b)(c.a,{value:"michelson",mdxType:"TabItem"},Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"")))))}p.isMDXComponent=!0}}]);