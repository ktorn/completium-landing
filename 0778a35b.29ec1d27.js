(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{226:function(e,n,t){"use strict";t(0),t(230)},77:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return s})),t.d(n,"toc",(function(){return i})),t.d(n,"default",(function(){return l}));var o=t(3),a=(t(0),t(224)),c=(t(226),t(227),t(228),t(225));const r={id:"escrow7",title:"Interactions",sidebar_label:"Interactions",slug:"/dapp-escrow/interactions"},s={unversionedId:"dapp-escrow/escrow7",id:"dapp-escrow/escrow7",isDocsHomePage:!1,title:"Interactions",description:"Contract origination",source:"@site/docs/dapp-escrow/escrow7.md",slug:"/dapp-escrow/interactions",permalink:"/docs/dapp-escrow/interactions",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/dapp-escrow/escrow7.md",version:"current",sidebar_label:"Interactions",sidebar:"dapps",previous:{title:"Contract Compilation",permalink:"/docs/dapp-escrow/compilation"},next:{title:"Collectible Cards",permalink:"/docs/dapp-nonfungible"}},i=[{value:"Contract origination",id:"contract-origination",children:[]},{value:"Fund transaction",id:"fund-transaction",children:[]},{value:"Complete transaction",id:"complete-transaction",children:[]}],p={toc:i};function l({components:e,...n}){return Object(a.b)("wrapper",Object(o.a)({},p,n,{components:e,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"contract-origination"},"Contract origination"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 49"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"HandleNext")," component ",Object(a.b)(c.a,{to:"/docs/dapp-tools/taquito#contract-origination",mdxType:"Link"},"originates")," the escrow contract with taquito."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"})," const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Origination 'contract'\n    ///////////////////////////////////////////////////////////////////////////\n  }\n")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.originate({\n  code: code,\n  storage: getStorage(\n    seller,                              // seller\n    account,                             // buyer\n    taxCollector,                        // taxcollector\n    (parseInt(price)*1000000).toString() // price\n  )}\n}).send().then(op => {\n  console.log(`Waiting for confirmation of origination...`);\n  props.openSnack();\n  return op.contract()\n}).then (contract => {\n  props.closeSnack();\n  setAddress(contract.address);\n  props.handleNext();\n  console.log(`Origination completed for ${contract.address}.`);\n}).catch(error => console.log(`Error: ${JSON.stringify(error, null, 2)}`));\n")),Object(a.b)("p",null,"Note here that the constants ",Object(a.b)("inlineCode",{parentName:"p"},"taxrate"),", ",Object(a.b)("inlineCode",{parentName:"p"},"securityrate")," and ",Object(a.b)("inlineCode",{parentName:"p"},"deadline")," declared in contract's storage are actually not part of the storage since they are declared as ",Object(a.b)("inlineCode",{parentName:"p"},"constant")," and inlined in the contract code. Hence they are not required as parameters of ",Object(a.b)("inlineCode",{parentName:"p"},"getStorage"),"."),Object(a.b)("h2",{id:"fund-transaction"},"Fund transaction"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 123"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"}),"const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Call 'fund' entry point\n    ///////////////////////////////////////////////////////////////////////////\n  }\n")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.at(escrowState.address).then(contract => {\n  contract.methods.fund(UnitValue).send({ amount: total.toString() }).then(op => {\n    props.openSnack();\n    op.receipt().then(() => {\n      props.closeSnack();\n      setBalance(total.toString());\n      props.handleNext();\n    })\n  })\n});\n")),Object(a.b)("h2",{id:"complete-transaction"},"Complete transaction"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 123"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"}),"const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Call 'complete' entry points\n    ///////////////////////////////////////////////////////////////////////////\n}\n")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.at(escrowState.address).then(contract => {\n  contract.methods.complete(UnitValue).send().then(op => {\n    props.openSnack();\n    op.receipt().then(() => {\n      props.closeSnack();\n      setBalance(0);\n      props.handleNext();\n    })\n  })\n});\n")))}l.isMDXComponent=!0}}]);