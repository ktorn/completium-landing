(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{218:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return d})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(3),i=n(7),r=(n(0),n(227)),l=n(228),b=n(242),c=n(243),o={id:"template7",title:"Autocallable note",sidebar_label:"Autocallable note",slug:"/templates/acn"},d={unversionedId:"templates/template7",id:"templates/template7",isDocsHomePage:!1,title:"Autocallable note",description:"Introduction",source:"@site/docs/templates/template7.md",slug:"/templates/acn",permalink:"/docs/templates/acn",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/templates/template7.md",version:"current",sidebar_label:"Autocallable note",sidebar:"templates",previous:{title:"ICO",permalink:"/docs/templates/ico"},next:{title:"Escrow",permalink:"/docs/templates/escrow"}},s=[{value:"Introduction",id:"introduction",children:[]},{value:"API",id:"api",children:[{value:"Storage",id:"storage",children:[]},{value:"Entrypoints",id:"entrypoints",children:[]}]},{value:"Code",id:"code",children:[]}],m={toc:s};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},m,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"introduction"},"Introduction"),Object(r.b)("p",null,"This contract is the adaptation to the ",Object(r.b)(l.a,{to:"/docs/dapp-tools/tezos",mdxType:"Link"},"Tezos")," blockchain of an ",Object(r.b)(l.a,{to:"https://drive.google.com/file/d/0B64p1w9JOO-QQlhFQWEzMVl0cmRRVk5Td3d6czR5ZDRsWTRN/view",mdxType:"Link"},"autocallable note")," issued by Goldman Sachs."),Object(r.b)("p",null,"AutoCallable notes are short-term market-linked investments offering an above-market coupon if automatically matured prior to the scheduled maturity date. The product is automatically matured (\u201cauto-called\u201d) if the reference asset is at or above its initial level on a predetermined observation date. If called, the investor will receive their initial principal investment plus an above-market coupon."),Object(r.b)("p",null,"Because of the passive nature of the blockchain, the contract here is an escrow of the issuer's payments (interests and redeem amounts in due time). At any time, the holder can check whether the escrowed amount is equal to what was initially planned by the contract, by calling the ",Object(r.b)("inlineCode",{parentName:"p"},"check")," entrypoint. If the balance is not equal to the expected amount, the contract goes to state ",Object(r.b)("inlineCode",{parentName:"p"},"Defaulted"),". The holder may then turn to a dispute resolution mecanism to recover the due amount, the contract state being the proof of the default in payment."),Object(r.b)("p",null,"Fixing values are provided to the contract by the ",Object(r.b)("inlineCode",{parentName:"p"},"oracle")," address. Knowing that these data are licensed by market places to their customers, it is an open question to know whether the publically available blockchain data is a no-go. The challenge for the DeFi is to find business models not based on fixing values, but rather on the operation of such contracts."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Thank you to Alain Frisch, CTO at ",Object(r.b)(l.a,{to:"https://www.lexifi.com/",mdxType:"Link"},"Lexifi"),", for this example contract and his help to adapt it. Lexifi provides financial services with a DSL (Domain Specific Language) to execute and simulate financial contracts. Alain Frish also provided the corresponding Lexifi code, automatically extracted by Lexifi drivers from the above document.")),Object(r.b)("h2",{id:"api"},"API"),Object(r.b)("p",null,"The contract relies on the 3 underlyings: Bank of America, Soci\xe9t\xe9 G\xe9n\xe9rale and Union des Banques Suisses."),Object(r.b)("h3",{id:"storage"},"Storage"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Name"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Type"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"issuer")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"address")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Issuer address, transfers note payments.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"holder")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"address")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Holder address, checks the contract balance.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"oracle")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"address")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Oracle address, provides fixing values.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"nominal")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"tez")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Nominal value transfered by holder to confirm start of contract.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"trade")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"date")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Trade date.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"final")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"date")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Final Fixing date.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"gredemption")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"date")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Redemption date.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"bac_initial")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"rational")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Initial Bank of America Fixing rate.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"sg_initial")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"rational")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Initial Soci\xe9t\xe9 G\xe9n\xe9rale rate.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"ubs_initial")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"rational")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Initial Union des Banques Suisses rate.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"bac_strike")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"rational")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Bank of America strike rate.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"sg_strike")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"rational")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Soci\xe9t\xe9 G\xe9n\xe9rale strike rate.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"ubs_strike")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"rational")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Union des Banques Suisses strike rate.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"early")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"collection")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Early redemption, defined by:",Object(r.b)("ul",null,Object(r.b)("li",null,"Observation date"),Object(r.b)("li",null,"Early redemption date"),Object(r.b)("li",null,"Trigger percentage"),Object(r.b)("li",null,"Early redemption value")),Object(r.b)("p",null),"If on one of the Observation dates, the Fixing of each Underlying is equal to or above its respective Trigger Percentage multiplied by the Fixing (Initial), the Note will be redeemed and the Investor will receive on the respective Early Redemption Date an amount equal to the relevant Early Redemption Value multiplied by the Nominal.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"interest")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"collection")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Interest, defined by:",Object(r.b)("ul",null,Object(r.b)("li",null,"Interest Observation Date"),Object(r.b)("li",null,"Interest Payment Date"),Object(r.b)("li",null,"Interest Barrier Percent"),Object(r.b)("li",null,"Interest Rate")),Object(r.b)("p",null),"If on one of the Interest Observation Dates, the Fixing of each Underlying is equal to or above its respective Interest Barrier Percent multiplied by the Fixing (Initial) , the Investor will receive on the respective Interest Payment Date an amount equal to the relevant Interest Rate multiplied by the Nominal.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"fixing")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"collection")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Fixing value defined by:",Object(r.b)("ul",null,Object(r.b)("li",null,"Observation Date"),Object(r.b)("li",null,"Bank of America Fixing"),Object(r.b)("li",null,"Soci\xe9t\xe9 G\xe9n\xe9rale Fixing"),Object(r.b)("li",null,"Union des banques Suisses")),Object(r.b)("p",null),"Fixing values are provided by ",Object(r.b)("inlineCode",{parentName:"td"},"oracle"),".")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"actual_payment")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"tez")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Total payment by issuer.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"state_")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"states")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"One of:",Object(r.b)("ul",null,Object(r.b)("li",null,Object(r.b)("inlineCode",{parentName:"td"},"Created")," (intial state)"),Object(r.b)("li",null,Object(r.b)("inlineCode",{parentName:"td"},"Canceled")," (holder or issuer has canceled the contract)"),Object(r.b)("li",null,Object(r.b)("inlineCode",{parentName:"td"},"Defaulted")),Object(r.b)("li",null,Object(r.b)("inlineCode",{parentName:"td"},"Terminated"))))))),Object(r.b)("h3",{id:"entrypoints"},"Entrypoints"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Name"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Parameters"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"add_fixing")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"ffobservation"),", ",Object(r.b)("inlineCode",{parentName:"td"},"fbac"),", ",Object(r.b)("inlineCode",{parentName:"td"},"fsg"),", ",Object(r.b)("inlineCode",{parentName:"td"},"fubs")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(r.b)("inlineCode",{parentName:"td"},"oracle")," to provide Fixing values for underlyings.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"pay_note")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(r.b)("inlineCode",{parentName:"td"},"issuer")," to transfer payment notes.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"confirm")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(r.b)("inlineCode",{parentName:"td"},"holder")," who transfers ",Object(r.b)("inlineCode",{parentName:"td"},"nominal")," amount to ",Object(r.b)("inlineCode",{parentName:"td"},"issuer")," via contract. Sets contract state to ",Object(r.b)("inlineCode",{parentName:"td"},"Confirmed"),".")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"cancel")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(r.b)("inlineCode",{parentName:"td"},"holder")," or ",Object(r.b)("inlineCode",{parentName:"td"},"issuer")," to cancel contract.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"check")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(r.b)("inlineCode",{parentName:"td"},"holder")," to compare actual payments with expected payments. If different, sets the contract to ",Object(r.b)("inlineCode",{parentName:"td"},"Defaulted")," state.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"terminate")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null})),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Called by ",Object(r.b)("inlineCode",{parentName:"td"},"holder")," to terminate contract.")))),Object(r.b)("h2",{id:"code"},"Code"),Object(r.b)(b.a,{defaultValue:"archetype",values:[{label:"Archetype",value:"archetype"},{label:"Storage",value:"storage"},{label:"Michelson",value:"michelson"},{label:"Specification",value:"specification"}],mdxType:"Tabs"},Object(r.b)(c.a,{value:"archetype",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype",metastring:'title="autocallable.arl"',title:'"autocallable.arl"'}),"archetype autocallable(\n  issuer  : role,\n  holder  : role,\n  oracle  : role,\n  nominal : tez,\n  trade   : date,\n  final   : date,\n  gredemption : date,\n  (* UNDERLYINGS *)\n  bac_initial : rational,\n  sg_initial  : rational,\n  ubs_initial : rational,\n  bac_strike  : rational,\n  sg_strike   : rational,\n  ubs_strike  : rational\n)\n\nasset early {\n  eobservation : date;\n  redemption   : date;\n  trigger      : rational;\n  value        : rational;\n}\n\nasset interest {\n  iobservation : date;\n  payment     : date;\n  barrier     : rational;\n  rate        : rational;\n}\n\nasset fixing {\n  fobservation : date;\n  bac : rational;  (* Bank of America Corporation *)\n  sg  : rational;  (* Societe Generale *)\n  ubs : rational;  (* Union des Banques Suisses *)\n}\n\n(* EXPECTED PAYMENT COMPUTATION *)\nfunction compute_expected (d : date) : tez {\n  var expected = 0tz;\n  var terminated = false;\n  var redeem_date = final;\n  (* early redemption *)\n  for e in early do\n    if early[e].redemption <= d then begin\n      (* is there early redemption ? *)\n      var ee = early[e].eobservation;\n      if     fixing[ee].bac >= early[e].trigger * bac_initial\n         and fixing[ee].sg  >= early[e].trigger * sg_initial\n         and fixing[ee].ubs >= early[e].trigger * ubs_initial\n      then begin\n         expected += early[e].value * nominal;\n         redeem_date := early[e].eobservation;\n         terminated := true\n      end\n    end\n  done;\n  (* redemption *)\n  if not terminated and gredemption <= d then\n    if     fixing[gredemption].bac >= bac_strike\n       and fixing[gredemption].sg  >= sg_strike\n       and fixing[gredemption].ubs >= ubs_strike\n    then\n       expected += nominal\n    else begin\n       var bac_trigger = fixing[gredemption].bac / bac_strike;\n       var sg_trigger  = fixing[gredemption].sg  / sg_strike;\n       var ubs_trigger = fixing[gredemption].ubs / ubs_strike;\n       var worst = min ((min (bac_trigger, sg_trigger)), ubs_trigger);\n       expected += worst * nominal\n    end;\n  (* expected interests *)\n  var exp_interests = 0tz;\n  for i in interest do\n    if interest[i].iobservation <= redeem_date and interest[i].payment <= d\n    then begin\n      var ii = interest[i].iobservation;\n      if     fixing[ii].bac >= interest[i].barrier * bac_initial\n         and fixing[ii].sg  >= interest[i].barrier * sg_initial\n         and fixing[ii].ubs >= interest[i].barrier * ubs_initial\n      then exp_interests := interest[i].rate * nominal\n    end\n  done;\n  expected += exp_interests;\n  return expected\n}\n\n(* PAYMENT action *)\nvariable actual_payment : tez = 0tz\n\nentry pay_note () {\n   called by issuer\n   effect {\n      actual_payment += transferred\n   }\n}\n\nentry add_fixing (\n  ffobservation : date,\n  fbac          : rational,\n  fsg           : rational,\n  fubs          : rational) {\n  fixing.add({ffobservation; fbac; fsg; fubs})\n}\n\n(* STATE MACHINE *)\nstates =\n | Created initial (* doc initial state. *)\n | Canceled        (* holder or issuer has canceled the transaction. *)\n | Confirmed       (* holder has confirmed. *)\n | Defaulted\n | Terminated\n\n(* Used by holder to confirm transaction.\n   It transfers the price of contract (nominal) *)\ntransition confirm () {\n  called by holder\n  from Created\n  to Confirmed when { transferred = nominal }\n  effect { transfer transferred to issuer }\n}\n\ntransition cancel () {\n  called by holder or issuer\n  from Created\n  to Canceled\n}\n\ntransition check () {\n  called by holder\n  from Confirmed\n  to Defaulted when { actual_payment < compute_expected(now) }\n}\n\ntransition terminate () {\n  called by issuer\n  from Confirmed\n  to Terminated when { actual_payment >= compute_expected(now) }\n}\n"))),Object(r.b)(c.a,{value:"storage",mdxType:"TabItem"},Object(r.b)("p",null,"Code snippet to set initial storage according to values specified in contract."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype"}),"variable nominal : tez = 1000tz\n\nvariable trade       : date = 2017-03-14T00:00:00\nvariable init        : date = 2017-03-14T00:00:00\nvariable issue       : date = 2017-03-28T00:00:00\nvariable final       : date = 2020-03-16T00:00:00\nvariable gredemption : date = 2020-03-30T00:00:00\n\n(* UNDERLYINGS *)\nvariable bac_initial : rational = 25.32\nvariable sg_initial  : rational = 46.945\nvariable ubs_initial : rational = 15.98\n\nvariable bac_strike : rational = 12.66   (* ~ 0.5 * bac_initial *)\nvariable sg_strike  : rational = 23.4725 (* ~ 0.5 * sg_initial  *)\nvariable ubs_strike : rational = 15.98   (* ~ 0.5 * ubs_initial *)\n\n(* CONTRACT DATA *)\nasset early identified by eobservation {\n  eobservation : date;\n  redemption   : date;\n  trigger      : rational;\n  value        : rational;\n} with {\n  i1 : 0 <= trigger <= 1;\n  i2 : 0 <= value   <= 1;\n} initialized by {\n  { 2018-03-14T00:00:00; 2018-03-28T00:00:00; 0.95; 1 };\n  { 2018-06-14T00:00:00; 2018-06-28T00:00:00; 0.95; 1 };\n  { 2018-09-14T00:00:00; 2018-09-28T00:00:00; 0.95; 1 };\n  { 2018-12-14T00:00:00; 2019-01-02T00:00:00; 0.95; 1 };\n  { 2019-03-14T00:00:00; 2019-03-28T00:00:00; 0.80; 1 };\n  { 2019-06-14T00:00:00; 2019-06-28T00:00:00; 0.80; 1 };\n  { 2019-09-16T00:00:00; 2020-09-30T00:00:00; 0.70; 1 };\n  { 2019-12-16T00:00:00; 2020-01-02T00:00:00; 0.70; 1 };\n  { 2020-03-16T00:00:00; 2020-03-30T00:00:00; 0.70; 1 }\n}\n\nasset interest identified by iobservation {\n  iobservation : date;\n  payment     : date;\n  barrier     : rational;\n  rate        : rational;\n} with {\n  i3 : 0 <= barrier <= 1;\n} initialized by {\n  { 2017-06-14T00:00:00; 2017-06-28T00:00:00; 0.5; 2.025  };\n  { 2017-09-14T00:00:00; 2017-09-28T00:00:00; 0.5; 4.05   };\n  { 2017-12-14T00:00:00; 2018-01-02T00:00:00; 0.5; 6.075  };\n  { 2018-03-14T00:00:00; 2018-03-28T00:00:00; 0.5; 8.1    };\n  { 2018-06-14T00:00:00; 2018-06-28T00:00:00; 0.5; 10.125 };\n  { 2018-09-14T00:00:00; 2018-09-28T00:00:00; 0.5; 12.15  };\n  { 2018-12-14T00:00:00; 2019-01-02T00:00:00; 0.5; 14.175 };\n  { 2019-03-14T00:00:00; 2019-03-28T00:00:00; 0.5; 16.2   };\n  { 2019-06-14T00:00:00; 2019-06-28T00:00:00; 0.5; 18.225 };\n  { 2019-09-16T00:00:00; 2019-09-30T00:00:00; 0.5; 20.25  };\n  { 2019-12-16T00:00:00; 2020-01-02T00:00:00; 0.5; 22.275 };\n  { 2020-03-16T00:00:00; 2020-03-30T00:00:00; 0.5; 24.3   }\n}\n"))),Object(r.b)(c.a,{value:"michelson",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),""))),Object(r.b)(c.a,{value:"specification",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-archetype"}),"specification function compute_expected (d : date) {\n\n  (** etrigger is defined as the set of early assets for which\n      the trigger condition is true *)\n  definition etrigger { e : early |\n    forall f in fixing,\n      if e.eobservation = f.fobservation\n      then (* trigger condition *)\n            f.bac >= e.trigger * bac_initial\n        and f.sg  >= e.trigger * sg_initial\n        and f.ubs >= e.trigger * ubs_initial\n      else false\n  }\n  (** ibarrier is defined as the set of interest assets for which\n      the barrier condition is true *)\n  definition ibarrier { i : interest |\n    forall f in fixing,\n      (* retrieving the first element of etrigger *)\n      let some key_efirst = etrigger.nth(0) in\n      let some efirst = etrigger[key_efirst] in\n        if i.iobservation = f.fobservation and i.iobservation <= efirst.eobservation\n        then (* barrier condition *)\n                  f.bac >= bac_strike\n              and f.sg  >= sg_strike\n              and f.ubs >= ubs_strike\n        else false\n      otherwise false\n      otherwise false\n  }\n\n  (** expected is the sum of redemption nominal and interests *)\n  postcondition p_expected {\n      let expected : tez =\n        let some ftrigger_key = etrigger.nth(0) in\n        let some ftrigger = early[ftrigger_key] in\n        (* early redemption *)\n        ftrigger.value * nominal\n        otherwise\n        (* redemption *)\n        (let some f = fixing[gredemption] in\n        if     f.bac >= bac_strike\n           and f.sg  >= sg_strike\n           and f.ubs >= ubs_strike\n        then\n           nominal\n        else\n          let bac_trigger = f.bac / bac_strike in\n          let sg_trigger  = f.sg  / sg_strike  in\n          let ubs_trigger = f.ubs / ubs_strike in\n          let worst = min ((min (bac_trigger, sg_trigger)), ubs_trigger) in\n          worst * nominal\n        otherwise 0tz)\n        otherwise\n        (* redemption *)\n        let some f = fixing[gredemption] in\n        if     f.bac >= bac_strike\n           and f.sg  >= sg_strike\n           and f.ubs >= ubs_strike\n        then\n           nominal\n        else\n          let bac_trigger = f.bac / bac_strike in\n          let sg_trigger  = f.sg  / sg_strike  in\n          let ubs_trigger = f.ubs / ubs_strike in\n          let worst = min ((min (bac_trigger, sg_trigger)), ubs_trigger) in\n          worst * nominal\n        otherwise 0tz\n      in\n      (* interests *)\n      let interests =\n      if expected = 0tz then 0tz else\n        (let some lbarrier_key = ibarrier.nth(abs(ibarrier.count() - 1)) in\n        let some lbarrier = interest[lbarrier_key] in\n          let some v = fixing[lbarrier.iobservation] in\n          if    v.bac >= lbarrier.barrier * bac_initial\n            and v.sg  >= lbarrier.barrier * sg_initial\n            and v.ubs >= lbarrier.barrier * ubs_initial\n          then lbarrier.rate * nominal\n          else 0tz\n        otherwise 0tz\n        otherwise 0tz\n        otherwise 0tz)\n      in\n       result = expected + interests\n  }\n}\n")))))}p.isMDXComponent=!0},234:function(e,t,n){"use strict";function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}t.a=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}},240:function(e,t,n){"use strict";var a=n(0),i=n(241);t.a=function(){const e=Object(a.useContext)(i.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},241:function(e,t,n){"use strict";var a=n(0);const i=Object(a.createContext)(void 0);t.a=i},242:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(240),l=n(234),b=n(56),c=n.n(b);const o=37,d=39;t.a=function(e){const{lazy:t,block:n,defaultValue:b,values:s,groupId:m,className:p}=e,{tabGroupChoices:u,setTabGroupChoices:O}=Object(r.a)(),[j,g]=Object(a.useState)(b),f=a.Children.toArray(e.children);if(null!=m){const e=u[m];null!=e&&e!==j&&s.some((t=>t.value===e))&&g(e)}const N=e=>{g(e),null!=m&&O(m,e)},h=[];return i.a.createElement("div",null,i.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(l.a)("tabs",{"tabs--block":n},p)},s.map((({value:e,label:t})=>i.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":j===e,className:Object(l.a)("tabs__item",c.a.tabItem,{"tabs__item--active":j===e}),key:e,ref:e=>h.push(e),onKeyDown:e=>{((e,t,n)=>{switch(n.keyCode){case d:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case o:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(h,e.target,e)},onFocus:()=>N(e),onClick:()=>{N(e)}},t)))),t?Object(a.cloneElement)(f.filter((e=>e.props.value===j))[0],{className:"margin-vert--md"}):i.a.createElement("div",{className:"margin-vert--md"},f.map(((e,t)=>Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==j})))))}},243:function(e,t,n){"use strict";var a=n(3),i=n(0),r=n.n(i);t.a=function({children:e,hidden:t,className:n}){return r.a.createElement("div",Object(a.a)({role:"tabpanel"},{hidden:t,className:n}),e)}}}]);