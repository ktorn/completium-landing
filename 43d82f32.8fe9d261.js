(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{118:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return l})),a.d(t,"toc",(function(){return d})),a.d(t,"default",(function(){return p}));var n=a(3),r=a(7),b=(a(0),a(228)),i=a(231),c=a(229),o={id:"first2",title:"Deploy Smart Contract",sidebar_label:"2. Deploy Smart contract",slug:"/dapp-first/contract"},l={unversionedId:"dapp-first/first2",id:"dapp-first/first2",isDocsHomePage:!1,title:"Deploy Smart Contract",description:"The first step is to originate (deploy) the ownership Smart Contract with the admin test account that comes preconfigured with completium CLI.",source:"@site/docs/dapp-first/first2.md",slug:"/dapp-first/contract",permalink:"/docs/dapp-first/contract",editUrl:"https://github.com/edukera/completium-landing/tree/master/docs/dapp-first/first2.md",version:"current",sidebar_label:"2. Deploy Smart contract",sidebar:"first",previous:{title:"Technical environment",permalink:"/docs/dapp-first/gitpod"},next:{title:"Display contract data",permalink:"/docs/dapp-first/display-storage"}},d=[{value:"Create smart contract file",id:"create-smart-contract-file",children:[]},{value:"Copy contract code",id:"copy-contract-code",children:[]},{value:"Originate contract",id:"originate-contract",children:[]},{value:"Contract API",id:"contract-api",children:[{value:"Storage",id:"storage",children:[]},{value:"Entrypoints",id:"entrypoints",children:[]}]}],s={toc:d};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(b.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(b.b)("p",null,"The first step is to originate (deploy) the ownership ",Object(b.b)(c.a,{to:"/docs/dapp-tools/tezos#smart-contract",mdxType:"Link"},"Smart Contract")," with the ",Object(b.b)("em",{parentName:"p"},"admin")," test account that comes preconfigured with ",Object(b.b)(c.a,{to:"/docs/cli",mdxType:"Link"},"completium CLI"),"."),Object(b.b)("p",null,"Before anything, check the ",Object(b.b)("em",{parentName:"p"},"admin")," account balance. Open a new ",Object(b.b)(c.a,{to:"/docs/dapp-tools/gitpod#open-terminal",mdxType:"Link"},"Terminal")," tab and enter the command below:"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{}),"completium-cli show account\n")),Object(b.b)("p",null,"If the balance is below 3 tezies, then follow these ",Object(b.b)(c.a,{to:"/docs/dapp-tools/gitpod#check-admin-account",mdxType:"Link"},"instructions")," to import a new account (or transfer some tezies to the admin account)."),Object(b.b)("h2",{id:"create-smart-contract-file"},"Create smart contract file"),Object(b.b)("p",null,"Create a file named ",Object(b.b)("inlineCode",{parentName:"p"},"ownership.arl")," by right clicking in the left-hand panel:"),Object(b.b)(i.a,{img:"new_file.png",width:"50%",mdxType:"DappFigure"}),Object(b.b)("h2",{id:"copy-contract-code"},"Copy contract code"),Object(b.b)("p",null,"Copy-paste in ",Object(b.b)("inlineCode",{parentName:"p"},"ownership.arl")," the source code below and ",Object(b.b)("em",{parentName:"p"},"save")," the file (with ctrl/cmd + s)."),Object(b.b)("p",null,"(Click 'copy' in the upper-right-hand corner of the area below)"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-archetype"}),'archetype asset_ownership\n\nvariable assetid : bytes =\n  0x68746ecbcd72793aefda48f1b67a3190fc380a7633055d2336fb90cd990582a2\n\nvariable owner : address = @tz1MZrh8CvYkp7BfLQMcm6mg5FvL5HRZfACw\n\nvariable bestbidder : address = owner\nvariable bestbid    : tez = 0tz\n\nvariable endofbid   : date = now\n\nstates =\n| Owned initial\n| ForSale\n\ntransition upforsale (price : tez) {\n   called by owner\n   from Owned to ForSale\n   with effect {\n      bestbid := price;\n      endofbid := now + 5m;\n   }\n}\n\nentry bid() {\n   require {\n      r1 otherwise "Asset Not For Sale": state = ForSale;\n      r2: now < endofbid;\n      r3: caller <> bestbidder;\n      r4: transferred > bestbid;\n   }\n   effect {\n     if balance <> transferred then\n       transfer bestbid to bestbidder;\n     bestbidder := caller;\n     bestbid := transferred;\n     endofbid += 2m;\n   }\n}\n\ntransition claim () {\n  require { r5 otherwise "Bid Period Is Still On": now > endofbid }\n  from ForSale to Owned\n  with effect {\n     if balance > 0tz then\n         transfer balance to owner;\n     owner := bestbidder;\n  }\n}\n')),Object(b.b)("h2",{id:"originate-contract"},"Originate contract"),Object(b.b)("p",null,"Enter this command in the ",Object(b.b)(c.a,{to:"/docs/dapp-tools/gitpod#open-terminal",mdxType:"Link"},"Terminal"),":"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{}),"completium-cli deploy ownership.arl\n")),Object(b.b)("p",null,"It displays the main origination parameters and asks for confirmation. Enter ",Object(b.b)("inlineCode",{parentName:"p"},"Y")," and press enter."),Object(b.b)("p",null,"The output should look like:"),Object(b.b)("pre",null,Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"$ gitpod /workspace/completium-dapp-first $ completium-cli deploy ownership.arl\n? Confirm contract ownership.arl origination by 'admin' with 0 \ua729 on edo? Yes\nWaiting for confirmation of origination for KT1BAVw4WhU7BAs2jiakDv4VrR9CNzQK32rd ...\nOrigination completed for KT1BAVw4WhU7BAs2jiakDv4VrR9CNzQK32rd named ownership.arl.\nhttps://better-call.dev/edo2net/KT1BAVw4WhU7BAs2jiakDv4VrR9CNzQK32rd\n")),Object(b.b)("p",null,"Click on the generated link to display the contract in ",Object(b.b)(c.a,{to:"/docs/dapp-tools/bcd",mdxType:"Link"},"Better Call Dev")," indexer (it may take up to a dozen of seconds for BCD to synchronize with the blockchain). It shows the origination cost of 0.39\ua729."),Object(b.b)("h2",{id:"contract-api"},"Contract API"),Object(b.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(b.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(b.b)("h5",{parentName:"div"},Object(b.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(b.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(b.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(b.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(b.b)("p",{parentName:"div"},"This section is for information only, no action is required."))),Object(b.b)("p",null,"This section presents the ",Object(b.b)(c.a,{to:"/docs/dapp-first/contract#copy-contract-code",mdxType:"Link"},"contract")," API."),Object(b.b)("h3",{id:"storage"},"Storage"),Object(b.b)("p",null,"The contract stores the asset id and the owner address:"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Name"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"Type"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Initial Value"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"assetId")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"bytes"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Hash code of the asset."),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"0x68746e...")," (see below)")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"owner")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"address"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Address of the current asset owner."),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"tz1M...ACw")," (see below)")))),Object(b.b)("p",null,"It stores 4 extra variables used to implement the transfer of ownership process:"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Name"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"Type"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Initial Value"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"bestbidder")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"address"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Address of the best bidder; it is equal to the owner address when asset is not for sale."),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"owner"))),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"bestbid")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"tez"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Best bid amount."),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"0tz"))),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"endofbid")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"date"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Date of the end of bid."),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"now")," (date of origination)")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"_state")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"int"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Value is either 0 (not for sale) or 1 (for sale)."),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"0")," (not for sale)")))),Object(b.b)("h3",{id:"entrypoints"},"Entrypoints"),Object(b.b)("p",null,"The ownership contract provides three entrypoints:"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Name"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Parameter(s)"),Object(b.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"Description"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"upforsale")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"minimum selling price"),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Called by current owner to open bid process. Resulting contract state is ",Object(b.b)("inlineCode",{parentName:"td"},"ForSale"),".")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"bid")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Called by anyone. It requires: ",Object(b.b)("ul",null," ",Object(b.b)("li",null,"the asset to be up for sale"),Object(b.b)("li",null,"the bid period is not over"),Object(b.b)("li",null,"the transferred amount is above the current best bid amount"))," If these conditions are met, it transfers back the previous best bid amount to the previous best bidder, and updates the ",Object(b.b)("inlineCode",{parentName:"td"},"bestbidder")," and ",Object(b.b)("inlineCode",{parentName:"td"},"bestbid")," variables with new values; ",Object(b.b)("inlineCode",{parentName:"td"},"endofbid")," is incremented by 2 minutes.")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(b.b)("inlineCode",{parentName:"td"},"claim")),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:null})),Object(b.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Called by anyone. It requires: ",Object(b.b)("ul",null,Object(b.b)("li",null,"the asset to be up for sale"),Object(b.b)("li",null,"the bid period to be over")),"If these condidions are met, it transfers the best bid value to the previous owner, and sets the ",Object(b.b)("inlineCode",{parentName:"td"},"owner"),' variable to the best bidder address. Contract state is set back to "not for sale".')))))}p.isMDXComponent=!0}}]);