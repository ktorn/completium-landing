(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{198:function(e,n,t){"use strict";t(0),t(202)},76:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return i})),t.d(n,"toc",(function(){return p})),t.d(n,"default",(function(){return d}));var a=t(3),o=t(7),c=(t(0),t(197)),r=(t(198),t(200),t(201),t(199)),s={id:"escrow7",title:"Interactions",sidebar_label:"Interactions",slug:"/dapp-escrow/interactions"},i={unversionedId:"dapp-escrow/escrow7",id:"dapp-escrow/escrow7",isDocsHomePage:!1,title:"Interactions",description:"Contract origination",source:"@site/docs/dapp-escrow/escrow7.md",slug:"/dapp-escrow/interactions",permalink:"/docs/dapp-escrow/interactions",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/dapp-escrow/escrow7.md",version:"current",sidebar_label:"Interactions",sidebar:"escrow",previous:{title:"Contract Compilation",permalink:"/docs/dapp-escrow/compilation"},next:{title:"Interface",permalink:"/docs/dapp-escrow/interface"}},p=[{value:"Contract origination",id:"contract-origination",children:[]},{value:"Fund transaction",id:"fund-transaction",children:[]},{value:"Complete transaction",id:"complete-transaction",children:[]}],l={toc:p};function d(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"contract-origination"},"Contract origination"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 49"),Object(c.b)("p",null,"The ",Object(c.b)("inlineCode",{parentName:"p"},"HandleNext")," component ",Object(c.b)(r.a,{to:"/docs/dapp-tools/taquito#contract-origination",mdxType:"Link"},"originates")," the escrow contract with taquito."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"})," const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Origination 'contract'\n    ///////////////////////////////////////////////////////////////////////////\n  }\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.originate({\n  code: code,\n  storage: getStorage(\n    seller,                              // seller\n    account,                             // buyer\n    taxCollector,                        // taxcollector\n    (parseInt(price)*1000000).toString() // price\n  )}\n}).send().then(op => {\n  console.log(`Waiting for confirmation of origination...`);\n  props.openSnack();\n  return op.contract()\n}).then (contract => {\n  props.closeSnack();\n  setAddress(contract.address);\n  props.handleNext();\n  console.log(`Origination completed for ${contract.address}.`);\n}).catch(error => console.log(`Error: ${JSON.stringify(error, null, 2)}`));\n")),Object(c.b)("p",null,"Note here that the constants ",Object(c.b)("inlineCode",{parentName:"p"},"taxrate"),", ",Object(c.b)("inlineCode",{parentName:"p"},"securityrate")," and ",Object(c.b)("inlineCode",{parentName:"p"},"deadline")," declared in contract's storage are actually not part of the storage since they are declared as ",Object(c.b)("inlineCode",{parentName:"p"},"constant")," and inlined in the contract code. Hence they are not required as parameters of ",Object(c.b)("inlineCode",{parentName:"p"},"getStorage"),"."),Object(c.b)("h2",{id:"fund-transaction"},"Fund transaction"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 123"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Call 'fund' entry point\n    ///////////////////////////////////////////////////////////////////////////\n  }\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.at(escrowState.address).then(contract => {\n  contract.methods.fund(UnitValue).send({ amount: total.toString() }).then(op => {\n    props.openSnack();\n    op.receipt().then(() => {\n      props.closeSnack();\n      setBalance(total.toString());\n      props.handleNext();\n    })\n  })\n});\n")),Object(c.b)("h2",{id:"complete-transaction"},"Complete transaction"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"./src/components/escrow.js")," line 123"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const handleNext = () => {\n    ///////////////////////////////////////////////////////////////////////////\n    // FIX ME\n    // Call 'complete' entry points\n    ///////////////////////////////////////////////////////////////////////////\n}\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"tezos.wallet.at(escrowState.address).then(contract => {\n  contract.methods.complete(UnitValue).send().then(op => {\n    props.openSnack();\n    op.receipt().then(() => {\n      props.closeSnack();\n      setBalance(0);\n      props.handleNext();\n    })\n  })\n});\n")))}d.isMDXComponent=!0}}]);